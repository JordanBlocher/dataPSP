\documentclass[12pt]{article}
 
\usepackage[text={6in,8.1in},centering]{geometry}

\usepackage{enumerate}
\usepackage{amsmath,amsthm,amssymb}
\usepackage{mathrsfs} % to use mathscr fonts

\usepackage{multicol}
\usepackage{url}

\usepackage{epstopdf}
\usepackage{caption,subcaption}
\usepackage{pstricks}
\usepackage{pst-solides3d}
\usepackage{pstricks-add}
\usepackage{graphicx}
\usepackage{pst-tree}
\usepackage{pst-poly}
\usepackage{calc,ifthen}
\usepackage{float}\usepackage{multicol}
\usepackage{multirow}
\usepackage{array}
\usepackage{longtable}
\usepackage{fancyhdr}
\usepackage{algorithmicx}
\usepackage[noend]{algpseudocode}
\usepackage{changepage}
\usepackage{color}
\usepackage{listings}
\usepackage{fancyvrb}
\usepackage{verbatim,moreverb}
\usepackage{courier}
\usepackage{algorithm}

\lstset{ %
language=C++,               
basicstyle=\footnotesize,
numbers=left,                  
numberstyle=\tiny,     
stepnumber=1,         
numbersep=5pt,         
backgroundcolor=\color{white},  
showspaces=false,               
showstringspaces=false,         
showtabs=false,                 
columns=fullflexible,
frame=single,          
tabsize=2,          
captionpos=b,       
extendedchars=true,
xleftmargin=17pt,
framexleftmargin=17pt,
framexrightmargin=17pt,
framexbottommargin=4pt,
breaklines=true,       
breakatwhitespace=false, 
escapeinside={\%*}{*)}       
}

\newenvironment{block}{\begin{adjustwidth}{1.5cm}{1.5cm}\noindent}{\end{adjustwidth}}

\newtheorem{proposition}{Proposition}[section]
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}{Lemma}[section]
\newtheorem{corollary}{Corollary}[section]
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]

 
\def\verbatimtabsize{4\relax}
\def\listingoffset{1em}
\def\listinglabel#1{\llap{\tiny\it\the#1}\hskip\listingoffset\relax}
\def\mylisting#1{{\fontsize{10}{11}\selectfont \listinginput[1]{1}{#1}}}
\def\myoutput#1{{\fontsize{9}{9.2}\selectfont\verbatimtabinput{#1}}}

\newcommand{\vs}{\varsigma}
\newcommand{\mcL}{\mathcal{L}}
\newcommand{\mcI}{\mathcal{I}}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
 
\headsep25pt\headheight20pt
 
 
\pagestyle{fancyplain}
\rhead{\fancyplain{}{\small\bfseries Blocher, Jordan}}
\cfoot{\ \hfill\tiny\sl Draft printed on \today}
 
 
\setlength{\extrarowheight}{2.5pt} % defines the extra space in tables
 
\begin{document}
\begin{multicols}{2}

\section{Abstract}

We investigate the 2cm app, a data-exchange platform published for China Mobile Hong
Kong 4G Pro Service Plan customers. Telecommunications providers' revenue is typically
gained by charging users a fixed fee for a maximum amount
of data usage in a month, i.e., a monthly data cap \cite{???}. 
2cm's (2nd exchange market) data exchange platform allows users to submit
bids to buy and sell data.
This usage model, is, as far as our knowledge, the first data trading
platform that allows customers to buy and sell their own data.
We describe a distributed auction mechanism for data exchange inspired by the
classic PSP throughput problem,
and prove that our distributed data exchange mechanism provides incentive
compatibility (social choice function), and that we have efficiency
using only partial valuation information of each participant in an exchange market.

In applying a distributed PSP implementation to CMHK's secondary market, we
find that
the market is able to achieve an equilibrium as the sellers and buyers have an
incentive for a collaborative exchange, and design our mechanism tp provide the functions
for effective communication between the connected users. We claim that in
this secondary market our formulation holds the desired VCG qualities through the construction of a
probable equilibrium \cite{???}. We further provide bounds on the auction duration, 
with respect to the classic throughput problem.
and provide simulated results on convergence time to support our (FIND
COMPETITVE RATIO!), and a bound
on the convergence of our mechanism. We extend the works of cite!cite!
i.e. (market influence/EQ,social EQ,payment/allocation models) OR (bandwidth, data bundles, distributed
market algorithms) and show the existence of a dynamic global market equilibrium, allowing for a unique set of market dynamics.



\section{Introduction}

In this work, we propose \emph{a distributed progressive second price (PSP) auction in
order to maximize social utility in this secondary market}. Using the
distributed PSP mechanism on CMHKs data
exhange platform, we show that for cellular data allocated between multiple users there
exists an $\epsilon$-Nash market equilibria. A quality of the PSP auction is that
demand information is not known centrally, rather, it is distributed in the
buyers' valuations. The mechanism for an auction is defined
as \emph{distributed} when the allocations at any element depend only on
\emph{local} state: the quantity offered by the seller at that element, and the
bids for that element only \cite{lazar}. In this work, the proposed mechanism
allows the distribution of bids, where there are many providers each holding
thier own local auction; there is no entity that holds a global market knowledge.

In a PSP mechanism, bids consist of (i) an available (required) quantity and (ii) a unit-price (calculated
using its own demand functions). Buyers submit bids cyclically until an
($\epsilon$-Nash) equilibrium is reached and a local auction is concluded. 

(FEE IS FIXED OR
PER-UNIT?)(HOW DO WE MODEL ISP REVENUE? IMMEDIATE FUTURE)

The form of the auction mechanism presented here is (CAN BE? NEED TO SHOW TO
CLAIM 'IS') described as a
pure-strategy progressive game with incomplete, but perfect information. (WHAT
DOES NASH SAY ABOUT THIS?) (TRY MIXED? CAN ONLY HAVE MIXED WITH A DISTRIBUTED
VALUATION.. FUTURE WORK) 

\subsection{Distributed Progressive Second Price Auctions}

\subsubsection{Allocation using PSP}

We begin with a brief introduction to the generalized distributed PSP auction, first introduced by Lazar and Semret \cite{lazar}.
We define a set of $\mcI = \lbrace 1,\cdots,I\rbrace$ users.

Suppose each user $i \in \mcI$ makes a bid $s_i^j = (p_i^j, d_i^j)$ to the
seller of resource $j$, where $p_i^j$ is the unit-price the user is willing to
pay and $d_i^j$ is the quantity the user desires. The \emph{bidding profile} forms a grid, $s \equiv
[s_i^j] \in \mcI \times \mcI$, and $s_{-i} \equiv [s_1^j , \cdots , s_{i−1}^j , s_{i+1}^j , \cdots
, s_I^j]_{j\in\mcI}$ is the profile of user $i$'s opponents. 

Using this classic PSP mechanism, \cite{lazar} shows that given the opponents
bids $s_{-i}$,
user $i$'s $\epsilon$-best response $s_i = (w_i, v_i)$ as a Nash move
where $\epsilon > 0$ is the bid fee, $b_i$ is user $i$'s budget, and every user
has an elastic demand function.

Based on the profile of bids $s^j = (s^j_1, \cdots s^j_I)$, there exists
an allocation $(a^j, c^j) = A^j(s^j)$, where $a^j_i$ is the quantity given to
each user $i\in\mcI$ and $c^j_i$ is the total cost charged to user $i$. $A^j$ is the
allocation rule of seller $j$. It is feasible if $a^j_i \le d_i^j$, and $c^j_i \le  p^j_i d_i^j$.



We intend to show that our auction
is rational and achieves the desired VCG properties, as does the original
formulation. Using \cite{zheng} as a basis for our model, and \cite{lazar} as
realistic, theoretic, and notational templates, we define optimal strategies for
CMHK users, and demonstrate that the development of a set PSP auction mechanisms
in a data exchange setting is able achieve a network equilibrium for cellular data. 


We intend to show that our PSP constraints are
sufficient to attain the desirable property of truthfullness through incentive compatibility. We
reason, due to our pricing mechanism, that our formulation upholds the \emph{exclusion-compensation
principle}, and is a valid progressive second price auction to the extent that buyer $i$
pays for its allocation so as to exactly cover the ``social opportunity cost"
which is given by the declared willingness to pay (bids) of the users who are
excluded by $i$'s presence, and thus also compensates the seller for the maximum lost potential
revenue \cite{lazar}.

We will introduce a user type called an \emph{opt-out buyer} in order to perform our analysis. The
opt-out buyer restricts its pool of sellers. We extend the P2P rules described
in \cite{semret} to account for a set of \emph{local} data-exchange markets.
Our reserve price function is determined by the subset of nodes participating in the
auction, where the seller is its own auctioneer. This implies that the influence of the greater market on the individual
auctions will be influenced only by the submission of bids from buyers to
sellers. As a buyer may have access to multiple auctions, the sellers will be
dynamically influenced by the market via the $\epsilon$-best replies from the
buyers. We demonstrate that as the valuation function of seller $j$ is dependent
on the buyers demand, that the strategies of buyers and sellers may differ
drastically depending on the market.

\section{Related Work}

\section{The Problem Model}
\subsection{The Secondary Market}

We define the set of users, $\mcI = \lbrace 1, \cdots, I\rbrace$, who purchase or sell
data from other users. A buyer submits bids directly to sellers, where we
assume that all users submit bids in order to maximize their
(private) valuation functions. 

(TERRIBLE, FUTURE WORK) public information in the
secondary market consists of a set of offers that are published by users
wishing to sell their data overage. 

A user's identity $i \in \mcI$ as a subscript indicates that the user
is a buyer, and a superscript indicates the seller.
Suppose user $i$ is buying from user $j$. A bid $s_i^j = (d_i^j, p_i^j)$,
meaning $i$ would like to buy from $j$ a quantity $d^j_i$ and is willing to pay
a unit price $p^j_i$. Without loss of generality, we assume that all users bid in all
auctions; if a user $i$ does not submit a bid to $j$, then this means that
the user has the exact amout of data they require, or that seller $j$ does not have
enough data to satisfy the buyers demand, and we simply set $s_i^j = (0, 0)$.
A seller $j$ places an ask $s^j = (d^j, p^j)$, meaning $j$ is offering a
quantity $d^j$ , with a reserve unit price of $p^j$ . In other words, for a
superscript, the bid is understood as an offer in the secondary
market; we assume that data is a unary resource belonging to the seller, and
therefore can identify the data (for sale) with the identity of the user.
To further clarify this restriction, we note that since $i$ is not a seller,
the superscript notation will not be used, as $d^i = 0$ and
$a^i = 0$. In our current formulation, we do not allow a seller to submit
multiple bids to the secondary market (FUTURE WORK).

\section{Distributed PSP Analysis}

\subsection{User Behavior}

We assume that users are selfish, and therefore
rational. Users prefer to participate in the secondary market as it allows them to purchase
additional data for a cost less than the overage fee set by the ISP. 
User preferences are defined by a utility function, for any $i\in\mcI$,
\begin{align*}
    u_i : &S \rightarrow (-\infty, \infty) \\
          &s \rightarrow u_i(s).
\end{align*}
(TOO GENERAL?)

\subsubsection{Buyer Strategy}

Absent the cost or revenue from trading data, CMHK users gain utility from consuming
data. 
We will assume that the buyer valuation satisfies the conditions for an
\emph{elastic demand function}: 
\definition{\cite{lazar}}
A real valued function, $\theta(\cdot)_i$, is an \emph{(elastic) valuation
function} on $[0, D]$ if 
\begin{itemize}
    \item $\theta_i(0) = 0$,
    \item $\theta_i$ is differentiable,
    \item ${\theta_i}' \ge 0$, and ${\theta_i}'$ is non-increasing and continuous,
     \item There exists $\gamma > 0$, such that for all $z \in [0,D]$,
${\theta_i}'(z) > 0$ implies that for all $\eta \in [0, z), {\theta_i}'(z) \le
{\theta_i}'(\eta)
- \gamma(z - \eta)$. 
\end{itemize}

% OPT-OUT BUYER
We define a \textbf{opt-out buyer} as a user $i\in\mcI$ with utility
function,
\begin{equation}\label{buyerutility}
    u_i = \theta_i \circ e_i(a) - c_i,
\end{equation}
where $e_i : [0, \infty) \rightarrow [0,\infty)$ is %the expectation 
a function that maps buyer $i$'s data quantity (requirement) to matching
seller(s). We note that the opt-out buyers valuation depends only on a scalar $e_i(a)$ which is a function of the
quantities of all the available data for sale in the secondary market. 

Suppose the total amount of seller $j$'s data on the network at the instance that
user $i$ joins the auction is $b^j$. 
A sellers' allocation cannot exceed the total amount they have available,
i.e. $a_i^j \le b^j$. This will hold simultaneously for each $i \in
\mcI$ if and only if $b^j \ge \max_i \ a_i^j$. Therefore a seller $j$ is
restricted to subset of buyers $\in\mcI$.
Note that with our formulation, if a seller $j$ does not meet a buyer $i$'s data requirements, a
rational (utility-maximizing) buyer will set $s_i^j = 0$. The seller, in our analysis, is a functional
extension of the buyer, with valuation $\theta^j$ constructed by buyer demand.
We assume that buyers and sellers are separated (a seller does not also buy
data and vice versa).

Although it is possible for a seller to fully satisfy a buyer $i$'s demand, it
is also reasonable to expect that a seller may come close to using their
entire data cap, and only sell the fractional overage. In this case, we
determine that a buyer must coordinate their bids among multiple sellers. 
Buyer $i$'s valuation is interpreted as a unit valuation $\theta_i$,
moderated by the function $e$ which maps its data requirement to the distributed market. 
We propose the following strategy,
{
\proposition{(Opt-out buyer strategy)}\label{buyerstrategy}
Let $i\in\mcI$ be a buyer and define any auction duration
to be $\tau \in [0,\infty)$, and fix all other buyers' bids $s_{-i}$. 
For any allocation $a$, let
% OPT-OUT BUYER STRATEGY
\begin{equation}\label{opt-out}
    %e_i^j(a) \triangleq \frac{a_i^j}{\vs_i^j} 
    e_i^j(a) \triangleq a_i^j,
\end{equation}
and define,
% MIN SET
$$
    \ell_i =\argmax_{\mcI' \subset \mcI, \vert\mcI'\vert =
n}\sum_{j\in\mcI'} d^j.
$$
Buyer $i$ chooses its seller pool by determining $n$, where
\begin{equation}\label{buyercoordinate}
    %n = \argmin_{\ell_i}(j \in \ell_i : \displaystyle\sum_{n} \frac{d^n}{d_i}
    n = \argmin_{\ell_i}(j \in \ell_i : \displaystyle\sum_{n} d^n
\ge d_i\rbrace,
\end{equation} 
which produces a minimal subset 
\begin{equation}\label{sellers}
    \mcI_i = \lbrace j \in \mcI : j \le n\rbrace \subset \mcI.
\end{equation} 
Now let $j^* = n \le I$, and define, 
\begin{equation}\label{opt-minallocation}
    e_i(a) \triangleq e_i^{j^*}(a).
\end{equation}
we address the following special cases:\\
(Budget limited allocation)
\begin{equation}\label{partialallocation}
    d_i^j > b^j - \sum_{k\in\mcI^j, k\ne i} d_k^j.
\end{equation}
(Equal price allocation)
There exists $k,i \in \mcI^j, k\ne i$, such that
\begin{equation}\label{equalprice}
    \quad p_i^j = p_k^j.
\end{equation}
(Price-dominant allocation)
There exists $k \ni \mcI^j$, where $\forall \ i\ne k \in \mcI^j$.
\begin{equation}\label{newbuyer}
    p_k^j < p_i^j, 
    %p_i^j < p_k^j \quad \text{and} \quad d_i^j >= b^j, \quad \forall \ k \in \mcI^j.
\end{equation}
(Empty allocation)
\begin{equation}\label{emptyset}
    n > \vert \mcI\vert \Rightarrow \ell^j = \emptyset.
\end{equation}
In any of the above cases, seller $j$'s local auction strategy does not change and
Proposition \ref{sellerstrategy} holds.
Then, we have that $e_i$
is an optimal feasible strategy for buyer $i$.
}\\
\textbf{Proof:}
In the case that there exists a seller who can completely satisfy a buyers'
demand, $j^*=1$, $\vert \mcI_i\vert =1$ and (\ref{buyercoordinate}) holds. If such a buyer does not exist,
as the set $\ell_i$ is an ordered set, $i$ may discover 
$j^*$ by computing $\ell_i$. In the case that $d_i >
\sum_{j\in\mcI}d^j$, then $j^* > I$, we reason that this case is unlikely; our formulation reduces to a
monopoly, and the user pays the overage fee for data set by the provider which the upper bound of the sellers'
pricing function, where we consider the provider (AT\&T) as a seller. We also note that $\mcI_i$ is not the only
possible minimum subset $\in\mcI$ able to satisfy $i$'s demand, it is the
minimal ordered subset where a
coordinated bid is possible, which we will address in further analysis in Section \ref{analysis}.
Suppose there exists buyer $k\in \mcI^j$, such that
$e_k^j(a) \ge e_i^j(a)
\rightarrow p_k^j > p_i^{j}$ and so $d^j - d_k^j < z_i^{j*}$, resulting in a
partial allocation. Bid $s_k \in S_i$, and so is considered in buyer $i$'s strategy. 
As buyer $i$ is allowed to choose subset $\mcI_i$, and $\mcI_i$ is a minimal
set, (\ref{buyercoordinate}) states that $n$ is such that $e_i(a) = e_i^{j*}(a)
\ge e_k(a)$. We assume that $i$ will faithfully follow the opt-out strategy, and
so such a buyer $k$ cannot exist. 
Now, suppose that $p_k^j = p_i^j$, however $d_k^j > d_i^j$.

% BUYER LOCAL RESPONSE
{
\lemma{(Localized buyer response)}\label{buyerresponse}
As we cannot
assume that a buyers' bid will remain fixed at time $(t+1)$,
}\\
\textbf{Proof:} 
The first two cases, (\ref{partialallocation}) and (\ref{equalprice}) deal with
the problem of a buyer receiving a partial allocation:
In (\ref{partialallocation}), the winner with the lowest unit price $p_i^j$ results in a partial
allocation. In this case, using (\ref{buyercoordinate}), buyer $i$ will decrease its
quantity $d_i^j$ by increasing $n$, and will either remain a winner in $j$'s local
auction, or drop out of $\mcI^j$. (WILL USE LATER, DEVELOP MORE HERE?)
(\ref{equalprice}) considers that there may exist multiple buyers with the same unit price. The allocation rule (\ref{dataallocation}) determines that the data will be split proportinally
between all buyers with the same unit price. Therefore, again by
(\ref{buyercoordinate}), the buyers will increase $n$ until their demand is
met. 
The third case considers that a new buyer $k$ may enter the market with a better
price. There cannot be a buyer where $d_k^j > b^j$, as this violates
(\ref{budget}) imposed by (\ref{buyercoordinate}). When $d_k^j =
b^j$, the optimal solution at time $t$ is the single allocation, therefore at
time $(t+1)$, we have $\mcI^j = k$. It follows that in the case $d_k^j < b^j$, buyers $i\in\mcI^j$ will
lose their position in $\ell^j$ as the auction progresses and the minimal
subset $\mcI^j$ is computed. 
(BUYERS ARRIVE AS A POISSOIN PROCESS? FUTURE WORK)
Lastly, to resolve (\ref{emptyset}), $j$ chooses $n=I$, and sets its reserve price to $p_I^j$. 


\subsubsection{Buyer Influence}
To determine a strategy for the sellers, we first perform a general examination
of seller incentive. The potential revenue for $j$ at unit price $y$ is determined by the
demand of the buyers. $\forall \ y\ge 0$, we determine that the demand is given by,
% BUYER DEMAND 
\begin{equation}\label{datademand}
    \rho^j(y) = \sum_{i\in\mcI : p_i^j\ge y} d_i^j, 
\end{equation}
with ``inverse"
% SELLER REVENUE 
\begin{equation}\label{revenue}
    f^j(z) \triangleq \sup\big\lbrace y\ge 0:
        \rho_i^j(y) \ge z, \ \forall \ i \in \mcI\big\rbrace.
\end{equation}
For a given demand $\rho^j$, $f^j$ maps a unit of data to the highest price at
which it \emph{could} be sold to any buyer $i\in \mcI$ (as in \cite{semret}).
% SELLER VALUATION
We may now define the seller valuation (potential). 
{
\lemma{(Seller valuation)}\label{sellervaluation}
For any seller $j\in\mcI$, the contribution from buyer $i$'s valuation may be
modeled as,
\begin{equation}\label{singlevaluation}
    \theta_i^j = \int_0^{e_i^j(a)} f^j(z) \ dz.
\end{equation}
it follows that 
\begin{equation}\label{valuation}
    \theta^j \circ e = \displaystyle\sum_{i\in\mcI}
 \int_0^{e_i^j(a)} f^j(z) \ dz.
\end{equation}
}
\textbf{Proof:} 
We assume that a seller will try to maximize profit for any given allocation $a$, and
as such there is an incentive for $j$ to sell all of its data, and so 
$d_i^j = e_i \rightarrow \sum_{i\in{\mcI}} d_i^j = b^j =
\sum_{i\in\mcI} e_i$,
The remainder of the proof follows as in \cite{semret}. (REALLY THOUGH?)

The sellers' natural utility is the potential
profit $u^j = \theta^j\circ e$, where $\theta^j$ is the
potential revenue from the sale of data composed with each buyers' opt-out value, $e_i(a)$. 
This is intuitive as a seller who does not meet the demand of \emph{any} buyer will not
participate in any auction. We have chosen to omit the original cost of the data
paid to the ISP, as a discussion of mobile data plans is outside the scope of this
paper.  

As $j$ is restricted by
the bid strategy of the buyers, in addition to natural constraints, and we have the following Lemma.
{
% SELLER CONSTRAINTS
\lemma{(Seller constraints)}\label{constraints}
Let $j$ be a seller with budget $b^j$.
First, the seller must satisfy the quantity
constraint, 
\begin{equation}\label{quantity}
    d^j \ge e_i(a)
\end{equation}
and
\begin{equation}\label{budget}
    \displaystyle\sum_{i\in\mcI} e_i^j(a) \le \sum_{i\in\mcI} d^j_i \le b^j.
\end{equation}
In addition, for a rational seller, the reserve price must
satisfy 
\begin{equation}\label{reserveprice}
   p^j \ge \min_{i\in\mcI}\big({\theta_i}'(d_i^j)\big).
\end{equation}
}\\
\textbf{Proof:}
The first statement is an assumption, which we may enforce by (\ref{opt-out}),
and as a seller cannot sell more data than their bid, (\ref{budget}) enforces
the budget constraint for the seller. (\ref{reserveprice})
follows from the assumption that $j$ is rational, and so utility-maximization
acts as revenue maximization; a rational seller will not sell its
data at a price less than the lowest offer. (ASSUMPTIONS MADE HERE)


\subsubsection{Progressive User Strategy}
In order to to develop the seller strategy, it is necessary we determine 
that a seller has an incentive to
accept fractional bids (i.e. sell a fraction of their data $b^j$). Reasonably,
there may not exist a buyer such that $d_i = b^j$. In addition, a seller may accept
fractional bids in order to
maximize the revenue gained per unit of data by increasing market competition
\cite{???}.
Finally, in the case that the seller does not know the exact amount of
leftover data available, then they may only sell enough data to ensure that
they will not become a buyer while they submit their total data overage to the
secondary market. (FUTURE WORK? FROM \cite{zheng})

We describe the sellers' \emph{local} auction strategy for allocating its
data according to the constraints formed by the buyer strategy. As
local auction is progressive, and influenced by the $\epsilon$-best replies of
the buyers, we will need the following Lemma. (SHOULD I COUPLE THESE
ALGORITHMS? LESS OR MORE CONFUSING?)
We now define the local auction, which we describe, when coupled with the buyer
responses, as a progressive game of strategy with incomplete, but perfect
information (SAY MORE?).

% SELLER LOCAL STRATEGY
{
\proposition{(Localized seller strategy (i.e. fractional allocation))}\label{sellerstrategy}
Define any auction duration to be $\tau \in [0,\infty)$. For any seller $j$,
For any seller $j$, fix all buyers bids $s_i^j=(d_i^j,p_i^j)$ at time $t\in\tau$.

let the winner be determined by,
\begin{equation}\label{winner}
    \bar{i} = \displaystyle\argmax_{I^j}\sum_{i\in I^j} p_i^j.
\end{equation}
Also define
$$
    \ell^j =\argmax_{{\mcI}' \subset \mcI, \vert{\mcI}'\vert =
n}\sum_{i\in{\mcI}'} p_i^j,
$$
where,
\begin{equation}\label{sellercoordinate}
    n = \argmin_{\ell^j}(i \in \ell^j : \displaystyle\sum_{i\in\mcI^j} d_i^j >
b^j),
\end{equation} 
which gives $j$ a minimal subset 
\begin{equation}\label{buyers}
    \mcI^j = \lbrace i \in \mcI : i < n\rbrace \subset \mcI
\end{equation} 
of buyers that maximizes $j$'s revenue.
Define buyer $i^* = n \le I$ in the ordered set $\ell^j$.
Then, for time $(t+1)$, set $j$'s reserve price as 
\begin{equation}\label{newprice}
    p^j = \theta_{i^*}'(d_{i^*}^j) + \epsilon.
\end{equation}
and update $j$'s budget to reflect the (tentative) allocation,
\begin{equation}\label{newbudget}
    \bar{b}^{j(t+1)} = b^{j(t)} - d_{i^*}^{j(t)}.
\end{equation}
Allowing $t$ to range over $\tau$, with buyer responses given as in Lemma
\ref{buyerresponse}, we have that (\ref{winner}) - (\ref{newbudget}) produces a local
%Assuming that no new buyers enter the market, we have that (\ref{winner}) - (\ref{newprice}) produces a local
market equilibrium.% from time $t$ to $(t+1) \in \tau$.
}\\
\textbf{Proof:}
We will assume that the seller has enough data to satisfy at least one buyer,
in the case of multiple buyers $i^*$ is the \emph{losing} buyer with the highest unit
price offer, determined by (\ref{sellercoordinate}). As the set of buyers is
computed at each iteration, we are guaranteed a subset $\mcI^j \subset \mcI$ that is 
at equilibrium as it is designed so that the data offered by
seller $j$ equals the aggregate demand of the buyers \cite{???}
Although the buyers' valuation $\theta_i$ is not known to the seller, we assume
that the buyer is bidding truthfully, and so $p^j = {\theta_i}' + \epsilon
=p_i^j + \epsilon$, therefore $p^j$ is known, and as $\mcI^j\subset \mcI$, we
note that (\ref{budget}) and (\ref{reserveprice}) hold. Now, using
(\ref{singlevaluation}), we have, $\forall \ z\ge 0$,
\begin{align*}
    \int_0^{e_{i^*}^{j}(a)} f^{j}(z)\ dz &\le\int_0^{e_i^{j}(a)}
f^{j}(z) \ dz 
\end{align*}
and so,
$$
    \theta^j\circ e_{i^*}(a) \le \theta^j\circ e_i(a),
$$
which holds $\forall \ i \in \mcI^j$.
It follows that, using
%, using (\ref{buyercoordinate}), 
the definition of an $\epsilon$-best reply $s_i^j = (v_i^j, w_i^j)$,  
for any $\epsilon$-best reply, 
$$
    p^j \le {\theta_i}'(v_i^j) + \epsilon,
$$
$\forall i \in \mcI^j$.
Therefore the choice of $p^j$ does not force any buyers out of the local
equilibrium. Thus we determine the valuation between seller
$j$ and buyer $i$ is well-posed, the reserve price (\ref{newprice}) is justified, and the local
equlibirium created by $j$ is stable from time $t$ to $(t+1)$. 
(NEED TO SAY MORE HERE... INDUCTION? HOW DOES THE TENTATIVE AWARD WORK? SAVE
FOR NASH EQ PROOF? KEEP WITH t TO t+1?)

We conclude this section by reasoning that the user behavior restrictions are
necessary to formally define (and restrain) the incentives of the users. (OWN
WORDS) Since the sellers are driven by the buyers' demands, and the buyers are
competing in multiple local auctions hosted by the sellers, the two games are
inter-dependent, and may be played on the same or on a different scale in
valuation, time (AND....). PSP relies on the \emph{relevation prinicple}; the
PSP mechanism is able to demonstrate equlibrium by showing that PSP is
incentive-compatible. (MORE?)
Arrow's paradox is an impossibility theorem stating that when voters have three
or more distinct alternatives (options), no ranked voting electoral system can
convert the ranked preferences of individuals into a community-wide (complete
and transitive) ranking while also meeting a specified set of criteria:
unrestricted domain, non-dictatorship, Pareto efficiency and independence of
irrelevant alternatives.

Thus, (WHAT? FINISH, OWN WORDS)
The designer of a mechanism generally hopes either to design a mechanism
y() that "implements" a social choice function to find the
mechanism y() that maximizes some value criterion (e.g. profit)
Independence of irrelevant alternatives (IIA)
The IIA condition has three purposes (or effects)

Normative
Irrelevant alternatives should not matter.
Practical
Use of minimal information.
Strategic
Providing the right incentives for the truthful revelation of individual
preferences. 

% MECHANISM
\subsection{Data Auction Mechanism}\label{mechanism}
We may now proceed to formally define the PSP auction as a composition of the
buyers and sellers in the secondary market. We will denote the data-PSP rules
by including an overbar, in order to emphasize that they have been changed from
the original forms \cite{lazar}.
The market price function (MPF) for a buyer in the secondary market
can now be described as follows:
% NEW MARKET PRICE
\begin{align}\label{dataprice}
\begin{split}
    \bar{P}_i&(z, s_{-i}) =\displaystyle\sum_{j\in\mcI_i}P_i^j(z_i^j,
s_{-i}^j) \\
    &= \sum_{j\in\mcI_i}\bigg(\inf\bigg\lbrace y\ge 0 : 
    {\bar{D}_i^j}(y,s_{-i}^j) \ge z\bigg\rbrace \bigg),\\
\end{split}
\end{align}
and is interpreted as the aggragate of minimum prices that buyer $i$ bids in
order to obtain
data amount $z$ given an opponent profile $s_{-i}$. We note that
the total minimum price for the buyer must be an aggragation of the \emph{individual} prices of the buyers as it is
possible that $\mcI_i \ne \mcI^j$, and so the reserve prices of the individual sellers
may vary. 
%To simplify the notation, we define $z_i^j = d^j / \vs_i^j$ opt-out
%buyer $i$'s bid quantity. 
The maximum available quantity of data from seller
$j$ at price $y$ given $s_{-i}$ is: 
% NEW ALLOCATION RULE
\begin{align}
\begin{split}\label{datacomposed}
    \bar{D}_i^j(y,s_{-i}^j) &= D_i^j(y,s_{-i}^j)\ \circ\ e_i\\
    &= \bigg\lbrack d^j - \sum_{p_k^j> y} d_k^j\bigg\rbrack^+,
\end{split}
\end{align}
and we have the inverse price function as an aggragate over all local auctions
$j\in \mcI_i$,
% NEW INVERSE DEMAND
\begin{align}\label{datapriceinverse}
\begin{split}
    \bar{D}_i(y, s_{-i}) &= \displaystyle\sum_{j\in\mcI_i}\bigg(\sup\bigg\lbrace z\in \big( 0,
\bar{D}_i^j \big) : \\
    &\bar{P_i}(z,s_{-i}^j) < y\bigg\rbrace\bigg).
\end{split}
\end{align}
% DATA ALLOCATION RULE
The data allocation rule is given as in \cite{semret}, however with the
influence of the opt-out buyer strategy, the resulting allocation is a function of the total amount of data
required by buyer $i$ composed with its opt-out value and the allocation relies
on the incentives of the seller, so that $\forall \ i \in \mcI^j$,
% and so for profile $s_i$, for any $i \in \mcI$,
\begin{align}\label{dataallocation}
\begin{split}
    \bar{a}_i(s) &= a_i(s) \circ e_i =
\displaystyle\sum_{j\in\mcI_i}\bigg(\min\bigg\lbrace d_i^j,
\\
    &\frac{d_i^j}{\sum_{k:p_k^j=
p_i^j}d_k^j}
\bar{D}_i^j(p_i^j,s_{-i}^j)\bigg\rbrace\bigg).
\end{split}
\end{align}
Finally, we must have that the cost to the buyer adheres to the second price rule for each local auction:
% DATA COST
\begin{align}\label{datacost}
\begin{split}
    \bar{c}_i(s) &= \displaystyle\sum_{j\in\mcI_i} 
p^j \bigg(\bar{a}_j(0; s_{-i}^j)
    -\bar{a}_j(s_i^j;s_{-i}^j)\bigg).
\end{split}
\end{align}


The main contribution of this work 
is an auction mechanism inspired by the classic PSP throughput problem. In
order to apply a distributed PSP implementation to CMHK's secondary market,
we utilize our opt-out buyer and seller strategies in order to analize the
behavior of the resulting dynamical market. As both buyers and sellers are able
to change their bid strategies, and as each user only has \emph{local}
information about the bidding environment, it is clear that an unconstrained
market, even with a finite number of users, could suffer from the communication
expense from numerous local auctions trading an infinitely divisible resource.
We will assume that the cost of participatingn in the CMHK secondary market is
absorbed by the bid fee, which could represent data used in submitting bids, or
a fee charged per unit of data, or a flat rate charged at the completion of the
purchase. We perform a simple survey of these bid fee models, we
provide some idea of the expected revenue of the mobile data provider (NEED
STATS!). It is worth mentioning that CMHK users are not allowed to resell data purchased from the secondary
market, additionally, the purchased data expires (does not carry to the next
service period). Therefore, a simple definition of market equilibrium, where
supply equals demand, is insufficent to complete a comprehensive analysis of
the CMHK data-exchange market behavior. We will make an attempt to address why
our formulation at least partially considers some of these issues (BAD), such
as the impact of the bid fee on user behavior. (MOVE SOME OF THIS UP)
Finally, we  .... (WHAT? COMPLETE THE THOUGHT)

We claim that the market is
able to achieve an equilibrium as the sellers and buyers have an
incentive for a collaborative exchange, our mechanism provides the functions
for the effective communication between the connected users. It was shown in
\cite{lazar} that a $2$-dimensional message space is sufficient for the PSP
auction. Using a restricted message space is essential for the distributed
nature of our design (EXPLAIN), however, as a given message can come from many
possible types, there is no single
way to do the transformation from the direct revelation mechanism to the
desired one. This is equivalent to guessing the
right direct-revelation-to-desired-mechanism transformation and building it
into the allocation rule from the start. (FINISH!)
We claim that in
this secondary market our formulation not only holds the desired VCG qualities,
but minimizes comminication overhead (and so possibly fees paid to the provider)
and auction duration, resulting in a convergence time (FIND COMPETITVE RATIO?)
with respect to the classic throughput problem. 


\subsection{PSP Formulation}
Consider a user seeking to prevent
data overage by purchasing enough data from a subset of other network users.
This user $i$ can be modeled as a opt-out buyer where, as in \cite{semret},
$\vs_i^j$ corresponds to a fraction of user $j$'s data aquired by user $i$. In order to form the
distributed auction, we set $1$ if seller $j$ has enough data to
satisfy $i$'s demand, and $\vs_i^j=d_i$ otherwise. We intend to show that this
does not affect their valuation, and indeed, in this network setting, results in a shared network optima (a
global optimum). The formulation is inspired to the thinnest allocation route for
bandwidth given in \cite{lazar}. We note that if a single seller $j$ can
satisfy $i$'s demand, then
(\ref{buyerutility}) reduces to the original form, defined in
\cite{semret} as ``a simple buyer at a single resource element".

The sellers' auction will function as follows: at each bid iteration all buyers
submit bids, and the winning bid is the buyer $i$ that has the highest price
$p_i^j$. The seller allocates
data to this winner, at which point all other buyers are able to bid again, and
the winner leaves the auction (with the exception where multiple bidders bid
the same price, where (\ref{dataallocation}) determines they will not fully
satisfy their demand, and so we will assume they remain in the auction). The auction progresses as such until all the
sellers' data has been allocated. We design an algorithm based on the sellers'
fractional allocation strategy.

% SELLER ALGORITHM
\begin{algorithm}[H]
\caption{(Seller fractional allocation)}
\begin{algorithmic}[1]
\State $p^{j(0)} \gets \min_{i\in\mcI^j} p_i^j$
\State $s^{j(0)} \gets (p^j, b^j)$
\While{$b^j > 0$}
\State $\mcI^{j(t+1)} = \mcI^{j(t)}\setminus \lbrace i \in \mcI^{j(t)}: d_i^j >
\bar{b}^{j(t)}\rbrace$
\State $ i^* \gets \displaystyle\argmax_{I^j}\sum_{i\in I^j} p_i^j$ 
\State $\bar{b}^{j(t+1)} \gets \bar{b}^j - d_{i^*}^{j}$
%\State $p^j \gets \theta_{i^*}'(d_{i^*}^j)\circ e_i$
\State $p^j \gets p_{i^*}^j+\epsilon/2$ and $d^j \gets \bar{b}^j$
\State $s^{j(t+1)} \gets (d^j, p^j)$
\If{$\ \exists \ i : s_i^{j(t+1)} \ne s_i^{j(t)}$}
\State $\bar{b}^{j(t+1)} = \bar{b}^{j(t)}$
\State Go to 4.
\Else
\State $i^* \gets \bar a_i(s)$
%\State $\beta^{j(t+1)} \gets \bigg\lbrace i\in\mcI^j: 
%        d_i \le \bar{b}^j \bigg\rbrace$
\State Go to 4.
\EndIf
\EndWhile
\end{algorithmic}
\end{algorithm}
We assume that each time that $s^j$ is updated it is shared with all
participating buyers. At this point buyers have the opportunity to bid again,
where a buyer that does not bid again is assumed to hold the same bid, since a
buyer dropping out of the auction will set their bid to $s_i^j=(0,0)$. As we will show in our analysis, the buyers are bidding truthfully; the
algorithm makes use of the fact that the sellers' valuation is determined by
the buyers' market and upholds the PSP mechanism. (CHECK) (ALSO $j$ NEEDS TO
UPDATE FOR NEW BUYERS, $j$'S CONTROL)

(BUYER ALGORITHM? WHY NOT..., CLEANER)

% VCG ANALYSIS
\section{PSP Analysis}\label{analysis}
\subsection{Equilibrium}

Consider an opt-out buyer $i\in\mcI$. A PSP auction
allows for a buyer to react to opponents bids, and so its incentive is based on
the opponent profile.

Due to (\ref{buyerutility}), $i$ only has an incentive to change its bid
quantity if it increases its opt-out value $e_i$, and therefore its utility. 
We will show that $i$ can coordinate its
bids over $\mcI_i$ so that the opt-out value $e_i$ is the same for each
$j \in\mcI_i$, and therefore, without loss of utility, $i$ may choose a seller pool 
using a ``consistent" strategy, where for any $j\in \mcI_i$, $d_i^j = d_i^k, \
\forall \ k \in \mcI_i$, and still have feasible best replies. 
Our result shows that a buyer may select $\mcI_i$ in order to maximize its
utility while maintaining a coordinated bid strategy. 
It is intuitive that, if $j^*
< I$, a buyer may increase the size of $\mcI_i$, thereby lowering its bid
quantity while obtaining the same (potential) allocation $a_i$. 
(OWN WORDS!)
One important question to ask is why a bidder should bid with identical unit
prices on (j) all auctions and not reduce the unit price to a level where he still wins the
amount q i . The reason for this can be found in the pricing rule of the PSP auction. Since a
player is only charged with the cost of excluding other players from the market, the
unit price does not influence the final charges. Since this unit price reflects the
valuation of the total resources gained from the multi-auction market a player uses this price on all
auctions

% BUYER COORDINATION
{
\lemma{(Opt-out buyer coordination)}\label{coordinationlemma} 
Let $i\in\mcI$ be a opt-out buyer and fix all sellers' profiles $s^j$.
For any profile $s_i = (d_i, p_i)$, let $a_i \equiv \sum_j a_i^j(s)$ be the resulting data
allocation. For a fixed $s_{-i}$, a better reply for $i$ is $x_i =
(z_i,p_i)$, where $\forall \ j \in \mcI_i$,
$$
    z_i^j = e_i(a),
$$
and,
\begin{equation}\label{coordination}
    a_i^j(z_i,p_i) = z_i^{j^*},
\end{equation}
where $i$'s strategy is as in Proposition \ref{buyerstrategy}.
}\\
\textbf{Proof:}
As $s_{-i}$ is fixed, we omit it, in addition, we will use $u\equiv u_i \equiv u_i(s_i) \equiv
u_i(s_i;s_{-i})$. In full notation, we intend to show
$$
    u_i((d_i,p_i);s) \le u_i((z_i,p_i);s_{-i}).
$$
We address two cases:\\
1. \emph{There exists a seller who can fully satisfy $i$'s demand.} \\
In this case, $\vert\mcI_i\vert = 1$, and is trivial as no
coordination is necessary for a single bid. (SPECIAL CASE OF MONOPOLY? THINK!)\\
2. \emph{Buyer $i$'s demand can only be satisfied by purchasing data from multiple sellers.} \\
We will show that $i$ may increase $\vert\mcI_i\vert$, without decreasing $u_i$, so that
coordinated bid is possible. 
Buyer $i$ maintains ordered set $\ell_i$ where the sellers with the
largest bid quantities are considered first; the index of seller $j^*$ defines
a minimal subset $\mcI_i$, satisfying (\ref{buyercoordinate}). By construction, 
$d_i^{j^*}$ is the minimum quantity offered by any $j\in \mcI_i$,
so $d_i^{j^*} \le d_i^j, \ \forall \ j \in \mcI_i$ and also defines the
maximum quantity bid of any $k \ni \mcI_i$.
Thus by (\ref{opt-out}) and (\ref{opt-minallocation}), $\forall \ j\in \mcI_i$,
$$
    z_i^j = e_i(a) = e_i^{j^*}(a)  \le e_i^{j}(a),
$$
and for any $j\in\mcI_i$, we have $\forall \ l \ni \mcI_i$,
\begin{equation}\label{minimaleq}
e_i^{l}(a) 
     \le \bigg\lbrack d^{j} - \sum_{p_k^{l}> p_{i^*}^{j}} d_k^{l}\bigg\rbrack^+,
\end{equation}
where $p_{i^*}^j$ is the reserve price of the seller, defined in Proposision
\ref{sellerstrategy}, and is by definition the minimum price allowing any
allocations to be made by seller $j$. Now, as any $l \ni \mcI_i$ ... for any
$j\in\mcI_i$
(LOOK FOR $i^* = j^*$?)

1. buyers have same d but diff p
2. " same p but diff d i.e. d1 < d2

The inequality follows from
(\ref{dataallocation}) and that $P_i^j$ is non-decreasing, so $p_i^j \le p_i^{j^*} \ \forall \ j \ni \mcI_i$.
Now, by (\ref{dataallocation}),
\begin{align*}
     a_i^j(z_i,p_i) &=\min_{i\in\mcI^j}\bigg(z_i^j{^*}, \bigg\lbrack d^{j} - \sum_{p_k^{j}> p_i^{j^*}}
d_k^{j}\bigg\rbrack^+\bigg) \\
    &= z_i^{j^*}= e_i(a)
\end{align*}
by definition, and (\ref{minimaleq}) is proven.
%we have that buyers will submit equal bids to a minimum subset of sellers $\mcI_i$.
We proceed to demonstrate that $x_i$ does not result in a loss of utility for
buyer $i$; we will show that
$$
    u_i \le u_i(z_i,p_i).
$$
From (\ref{minimaleq}), we have $a_i^{j}(z_i,p_i) = z_i^{j^*} = e_i(a(z_i,p_i))$, which
implies that 
$$
\theta_i\circ e_i(a(z_i,p_i)) = \theta_i\circ e_i(a).
$$ 
Therefore, by the definition of utility (\ref{buyerutility}),
and the sellers' valuation (\ref{singlevaluation}), 
\begin{align*}
    &\theta_i\circ e_i(a(z_i,p_i)) - \theta_i(a)) \\
    &= u_i(z_i,p_i) - u_i =  c_i^j -c_i^{j^*}(z_i,p_i)\\
    &= \displaystyle\int_{a_i^j(z_i,p_i)}^{a_i^j} f_i(d^j - z) \ dz.
\end{align*}
Then, noting that $\theta_i\ge 0$, $\forall \ j\in\mcI_i$, $a_i(z_i,p_i) \le
z_i^j \le a_i^j \Rightarrow u_i(z_i,p_i) - u_i \ge 0$.


Finally, since (\ref{opt-out}) does
not increase the demand of seller $i$, $\sum_j c_i^j(s) \le b_i$, and so $x_i$ is feasible.

In effect, we are using the buyer demand
to partition the auction space, thereby 
controlling (optimizing?) the message space (EXPLAIN) for the
ISP, and providing an optimal market space to host the buyers and sellers based
on their type. \\

\subsubsection{Incentive Compatibility}

We proceed to claim that the optimality of truth-telling holds in our
formulation, where the market functions as a hybrid of \cite{semret} and
\cite{zheng}. The opt-out buyers' market is comprised of the minimal subset of
sellers with the largest budgets, described in the buyer strategy as $\mcI_i$.
To achieve incentive compatibility, we find that the opt-out buyer must choose this subset so that
its overall marginal value is greater than its market price.
The buyers' market price is calculated as the sum of reserve prices
of the sellers in the opt-out buyers' pool.
the market prices at the %different auctions, weighted by the data provisioning vector values.
The actual bids are
obtained from the opt-out buyers' strategy. The quantity to bid is given
by the auction mechanism, i.e. (\ref{dataprice}) and (\ref{datacomposed}), as
the maximim possible quantity of data that a buyer $i$ can bid over its seller
pool while maintaining a marginal valuation greater than the aggragate of
minimum prices maintained by the sellers in $i$'s pool.
As with a single resource, \cite{semret} and
\cite{lazar}, we show that truth-telling is optimal for the buyer, i.e. in each auction, the buyer sets
the bid price to the marginal value.
% BUYER INCENTIVE COMPATIBILITY
{
\proposition{(Buyer incentive compatibility)}\label{buyerincentivecompatibility}
Let $i\in\mcI$ be an opt-out buyer, and fix all other buyers' bids
$s_{-i}$, as well as the sellers' bids $s^j$ (so $a_i$ is fixed). \\
Let 
\begin{align}
\begin{split}
    z_i &= \sup\bigg\lbrace h\ge 0 : 
 {\theta_i}'(h) > \bar{P}_i^j(h)\bigg\rbrace, 
\end{split}\\
\begin{split}
    \chi_i &= \sup\bigg\lbrace h\ge 0: 
\displaystyle\int_0^h 
    \bar{P}_i(h) \ dh \le b_i\bigg\rbrace,
\end{split}
\end{align}
$e = \min(z_i, \chi_i - \epsilon / \theta_i'(0))^+$, and for each $j \in
\mcI_i$, 
$$
    v_i^j = e = v_i^{j^*}
$$
and 
$$
    w_i^j = w_i^{j^*} = \theta_i'(e).
$$
Then a (coordinated) $\epsilon$-best reply for the opt-out buyer is $t_i =
(v_i,w_i)$, i.e., $\forall \ s_i, u_i(t_i;s_{-i}) + \epsilon \ge u_i(s_i;
s_{-i})$.
} \\ \\
\textbf{Proof:} For ease of notation, we may assume that bid
$s_i^j=s_i^{j^*}$ and that each $j\in\mcI_i$.
First suppose $e = z_i$. Since $\theta_i'$ is non-increasing
and, $P_i^j$ is non-decreasing, (\ref{dataprice}) implies
$\theta_i'(e) >\sum_j P_i^j(v_i^j)$, due to $e$ being supremum, i.e.
greater than the marginal value, same as in \cite{semret}. This,
along with $i$'s strategy, gives $\forall \ y,z \ge 0$,
\begin{align*}
    \displaystyle\sum_{j} y &> \bar{P_i}(z,s_{-i}) \\
    &\Rightarrow y > P_i^j(z,s_{-i})\\
    &\Rightarrow
    z \le D_i^j(y,s_{-i})/\vs_i^j,
\end{align*}
and so,
\begin{align}\label{figureout}
\begin{split}
    w_i^j & > {P}_i^j(v_i^j) \\
    &\Rightarrow {D}_i^j = \frac{\lbrack d^j - d^j(w_i^j)\rbrack}{\vs_i^j}.
\end{split}
\end{align}
Now, let $y_i = {\theta_i}'(z_i)$ and suppose $z_i = 0$, then $v_i=0 \Rightarrow
a_i(t_i; s_{-i})=0$ and $i$'s coordinated bids (Lemma \ref{coordinationlemma})
gives $\bar{D}_i(0,s_{-i}) =0$. 
By the assumptions made in the definition of $i$'s valuation function $\theta_i$,
$$
w_i = {\theta_i}'(v_i) > {\theta_i}'(z_i) = y_i,
$$
and as $D_i^j$ is non-decreasing, $D_i^j(y_i,s_{-i}) \ge z_i \ge v_i$.
Thus, by (\ref{dataallocation}) and (\ref{figureout}),
\begin{align*}
    a_i^j(t_i; s_{-i}) = v_i^j \\
    e_i^j \circ a(t_i;s_{-i}) = e.
\end{align*}
Therefore,
\begin{align*}
    &\qquad u_i(t_i;s_{-i}) \\
    &= \displaystyle\int_0^\epsilon {\theta_i}'(\eta) \ d\eta -
\sum_j \int_0^{v_i^j} P_i^j(z) \ dz \\
    &= \int_0^\epsilon {\theta_i}'(\eta) \ d\eta - \sum_j\int_0^\epsilon
P_i^j(\eta/\vs_i^j) \ d\eta.
\end{align*}

Now suppose $\exists \ s_i = (d_i, p_i)$ such that $u_i(s_i;s_{-i}) > u_i(t_i;
s_{-i}) + \epsilon$. Let $\xi = \min_k e_i^k\circ a_i^k(s)$, and $\forall \ j,
\zeta_i^j = \xi/\vs_i^j$ and $s_{i^*} = (\zeta_i,p_i)$. Then from
(\ref{coordination}), $a_i^j(s_{i^*}; s_{-i}) = \zeta_i^j$, therefore
\begin{align*}
    &\qquad u_i(s_{i^*};s_{-i}) \\
    &= \displaystyle\int_0^\xi {\theta_i}'(\eta)\ d\eta -\sum_j\int_0^\xi P_i^j(\eta/\vs_i^j) \ d\eta.
\end{align*}
By Lemma \ref{coordinationlemma}, $u_i(s_{i^*}, s_{-i}) > u_i(t_i; s_{-i}) +
\epsilon$, which is equivalent to 
$$
    \int_\epsilon^\xi {\theta_i}'(\eta) \ d\eta - \sum_j\int_0^\xi
P_i^j(\eta/\vs_i^j) \ d\eta > \epsilon.
$$
The rest of the calculation follows as in \cite{semret} with the modified
framework, i.e. both $\bar\epsilon = \epsilon + \epsilon/{\theta_i}'(0)$ and
$\xi > \bar\epsilon$ show a contradiction.
(DO I NEED TO SHOW THE CONTRADICTION?)

We address the case where $e=\chi_i$, that is, the seller $j^*$'s data price is
equal to the budget of buyer $i$ under the strategy given in
(\ref{opt-out}), similarly to \cite{semret}, in this case any bid $s_{i^*}$
where $u_i(s_{i^*}) > u_i(t_i)$ is not feasible, as the buyer would go over its
budget.

Finally, suppose that $j^* = I$, that is, $\mcI_i = \mcI$. 
In this case, if $u_i(s_{i^*}) > u_i(t_i)$, then
the demand cannot be satisfied by the sellers and the bid is not feasible. 

We proceed to examine the strategy of the seller. As we have shown, the seller
is a functional extension of the buyer, with rules determined by the buyers'
behavior. As we have shown, the buyers are bidding truthfully, according to the
rule of incentive compatibility. Seller $j$'s reserve price is determined by a
buyer $i \in \mcI \setminus \mcI^j$, and therefore, even if this price is zero,
then $p^j = \epsilon \ge 0$.
We argue that if truthfullness holds \emph{locally} for both buyers and sellers, i.e. $p_i ={\theta_i}' \
\forall \ j \in \mcI_i$ and $p^j = {\theta^j}' \ \forall \ i \in\mcI^j$, then there exists a market
equilibrium. We have the following Lemma.

{
\lemma{(Incentive compatibility in local auctions)}
For any seller $j$, let time $t \in \tau$ be fixed, as well as bids from $j$'s
seller pool, so that $s_i$ is fixed $\forall \ i \in\mcI^j$. The
``$\epsilon$-best" reply for seller $j$ is,
$$
    s^j = (b^j, p^j),
$$
defined by Proposition \ref{sellerstrategy}.
%and fix $j$'s reserve price $p^j$ as is defined by (\ref{newprice}). 
The sellers' ``truthful" strategy, combined with Proposition
\ref{buyerincentivecompatibility}, forms a
``truthful" local game embeddeded within $j$'s auction, and an equilibrium of
the embedded game is an equlibrium point for the local auction. 
}\\
\textbf{Proof:}
We have that $p^j$ is the lowest price that $j$
will accept to perform any allocation. By the definition of ``reserve
price", $j$ is willing to buy its own budget $b^j$ at price $p^j$. This forms a
``truthful" local game embeddeded within $j$'s auction with strategy space
restricted to $\epsilon$-best replies from buyers $\in \mcI^j$. Therefore we have that a
fixed point in the ``truthful" local game is a fixed point for the auction.
To see this, we observe that from (\ref{datacomposed}), $\forall \ i \in \mcI^j$, $\bar{D}_i^j(y, s_{-i}) =
0 \ \forall \ y < p^j$, and so $y=0 \le \epsilon \Rightarrow e_i^j(a) = 0$. We
further argue that by Lemma \ref{buyerresponse}, and as the set $\mcI^j$ is
computed at each bid iteration, that our result holds for time $(t+1) \in \tau$.
(NEED MORE? EACH CASE IN 4.3?)

{
\lemma{(Static Data Nash Equilibrium)} 
}

% DATA NASH EQ
{
\theorem{(Data Nash Equilibrium)}
Using the rules of the data auction mechanism, the secondary market described in
\cite{zheng} converges to a $\epsilon$-Nash equilibrium. In the network auction
game with the data-PSP rules applied independently by each user according to their respective strategies, the secondary market converges to an $\epsilon$-Nash
equilibrium. 
}\\
\textbf{Proof:}
2. using the min price of sellers in the auction i.e. ${\theta_i}'(d_{i^*}^j) =
p^j$ is OK, \\
3. that bids are still feasible AND optimal \\
4. the algorithm achieves global economic equilibrium)\\
\textbf{NEED TO COVER:}\\
1. Change in buyer valuation \\
2. New buyers\\
3. Not enough buyers \\
4. Not enough data\\
\textbf{TRY:}\\
Sellers only act when the resources obtained by the buyers influence their
respective reserve prices, which agrees with the seller stragety of attempting
to sell their data in the first iteration. Therefore we claim there exists a
market stability and therefore, the existence of a Nash equilibrium. As the
valuation of the sellers is derived by the demand of the buyers, who are
bidding equivalent bids over a minimum subset of buyers, we claim that the seller
strategy, along with the seller constraint (\ref{??}) results in a global
market equilibrium.
We have shown that the local
equlibirium created by $j$ is stable from time $t$ to $(t+1)$. 
Now, suppose that buyer $i^*$ computes its best response $s_i^j = (v_i^j, w_i^j)$
Finally, suppose that
a buyer $k$ enters the market such that for some buyer $l\in\mcI^j$,
$$
    \displaystyle\sum_{i\in\mcI^j} p_i^je_i^j(a) + p_k^je_k^j(a) \ge
\sum_{i\in\mcI^j} p_i^je_i^j(a) - p_l^je_l^j(a),
$$
that is,



NOTES: (today)\\
1. switch from defined valuation function\\
2. finish seller incentive compat\\
3. work on progression\\
4. check reserve price = monopoly price

NOTES: (CMHK)
FAQ
Why I am not able to purchase extra data?
Incorrect input: Please follow the instruction on the failure SMS and try to
purchase extra data again. You can also call our 24 hours customer service
hotline at 2945 8888 to purchase extra data.
If you are still unable to purchase extra data after a few attempts, please call
our 24 hours customer service hotline for enquiries.

Can the remaining extra data be carried forward to the next bill month?
Extra data purchased can only be used within the bill month that it was
purchased. Remaining extra data will be forfeited by the end of that bill month
and will not be carried forward to the next bill month.
Can I sell the extra data purchased on 2cm Exchange Platform?
Extra data purchased cannot be sold on 2cm Exchange Platform.
Terms and Conditions of Data Top-up:
When the data entitlement of designated service plan is used up, customers can
purchase extra data within the bill month based on their needs to continue using
the data service. Otherwise, the data service will be suspended until the next
bill month. On the other hand, customers with Data+ VAS or Data+ Package can
enjoy unlimited local data service with designated maximum access speed limit
within the contract period after the data entitlement of the bill month is used
up. Data+ will not support tethering and pee-to-peer (P2P) upload and download,
including BitTorrent.
Data Top-up is only applicable to designated service plans, including but not
limited to “Supreme Global” Service Plan, “Supreme Asia” Service Plan, “Supreme
Greater China” Service Plan, 4.5G Full Speed Local Service Plan, 4.5G Full Speed
Share Service Plan,“Smart Care” Service Plan and Tertiary Student 4.5G Full
Speed Local Service Plan.
Customers can only purchase extra data again after the purchased extra data is
used up.
Extra data fee is subject to change. CMHK will charge to the customers at the
prevailing fee.
The purchased extra data is only applicable to the bill month that it was
purchased. Any remaining data (if applicable) cannot be carried forward.
The purchased extra data is not applicable to 2cm exchange platform.
Once the top-up data has been purchased, the related payment will not be
refunded.
CMHK reserves the right to modify the above content and amend these terms and
conditions at any time without prior notice.
In case of dispute, CMHK reserves the right of final decision.

\subsection{Efficiency}
(NEED OWN WORDS)
The objective in designing the auction is that, at equilbrium, resources al-
ways go to those who value them most. Indeed, the PSP mechanism does
have that property. This can be loosely argued as follows: for each player,
the marginal valuation is never greater than the bid price of any opponent
who is getting a non-zero allocation. Thus, whenever there is a player j
whose marginal valuation is less than player i 's and j is getting a non-zero
allocation, i can take some away from j , paying a price less than i 's marginal
valuation, i.e. increasing u i , but also increasing the total value, since i 's
marginal value is greater. Thus at equilibrium, i.e. when no one can unilat-
erally increase P their utility, the total value is maximized.

\subsection{Convergence}

\end{multicols}

\begin{thebibliography}{9}

\bibitem{zheng}
L. Zheng, C. Joe-Wong, C. W. Tan, S. Ha and M. Chiangs, 
\textit{Secondary markets for mobile data: Feasibility and benefits of traded
data plans}, 2015 IEEE
Conference on Computer Communications (INFOCOM), Kowloon, 2015, pp. 1580-1588.

\bibitem{lazar}
A. A. Lazar and N. Semret, 
\textit{“Design and Analysis of the Progressive Second Price Auction for Network
Bandwidth Sharing,”} Telecommunication Systems, Special Issue on Network Economics, 2000.

\bibitem{semret} 
N. Semret, 
\textit{“Market Mechanisms for Network Resource Sharing,”
Ph.D. thesis}. 
Columbia University, 1999.

\bibitem{tuffin}
Bruno Tuffin,
\textit{Revisited Progressive Second Price Auction for Charging
Telecommunication Networks}.
[Research Report] RR-4176, INRIA, 2001.

\bibitem{qpsp}
Clare W. Qu, Peng Jia, and Peter E. Caines,
\textit{Analysis of a Class of Decentralized Decision Processes: Quantized
Progressive Second Price Auctions},
2007 46th IEEE Conference on Decision and Control, New Orleans, LA, 2007, pp.
779-784.

\bibitem{cmhk}
\textit{China Mobile Hong Kong Company Limited}.
\url{https://www.hk.chinamobile.com/en/corporate_information/Data_N_VAS/DataTopup/index.html} 
2018

\bibitem{iia}
Andreu Mas-Colell, Michael Dennis Whinston, and Jerry R. Green, 
\textit{Microeconomic Theory}. Oxford University Press. 1995. p. 794.

\end{thebibliography}


\end{document}

