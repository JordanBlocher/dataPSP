\documentclass[12pt]{article}
 
\usepackage[text={6in,8.1in},centering]{geometry}

\usepackage{enumerate}
\usepackage{amsmath,amsthm,amssymb}
\usepackage{mathrsfs} % to use mathscr fonts

\usepackage{multicol}
\usepackage{url}

\usepackage{epstopdf}
\usepackage{caption,subcaption}
\usepackage{pstricks}
\usepackage{pst-solides3d}
\usepackage{pstricks-add}
\usepackage{graphicx}
\usepackage{pst-tree}
\usepackage{pst-poly}
\usepackage{calc,ifthen}
\usepackage{float}\usepackage{multicol}
\usepackage{multirow}
\usepackage{array}
\usepackage{longtable}
\usepackage{fancyhdr}
\usepackage{algorithmicx}
\usepackage[noend]{algpseudocode}
\usepackage{changepage}
\usepackage{color}
\usepackage{listings}
\usepackage{fancyvrb}
\usepackage{verbatim,moreverb}
\usepackage{courier}
\usepackage{algorithm}

\lstset{ %
language=C++,               
basicstyle=\footnotesize,
numbers=left,                  
numberstyle=\tiny,     
stepnumber=1,         
numbersep=5pt,         
backgroundcolor=\color{white},  
showspaces=false,               
showstringspaces=false,         
showtabs=false,                 
columns=fullflexible,
frame=single,          
tabsize=2,          
captionpos=b,       
extendedchars=true,
xleftmargin=17pt,
framexleftmargin=17pt,
framexrightmargin=17pt,
framexbottommargin=4pt,
breaklines=true,       
breakatwhitespace=false, 
escapeinside={\%*}{*)}       
}

\newenvironment{block}{\begin{adjustwidth}{1.5cm}{1.5cm}\noindent}{\end{adjustwidth}}

\newtheorem{proposition}{Proposition}[section]
\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}{Lemma}[section]
\newtheorem{corollary}{Corollary}[section]
\theoremstyle{definition}
\newtheorem{definition}{Definition}[section]

 
\def\verbatimtabsize{4\relax}
\def\listingoffset{1em}
\def\listinglabel#1{\llap{\tiny\it\the#1}\hskip\listingoffset\relax}
\def\mylisting#1{{\fontsize{10}{11}\selectfont \listinginput[1]{1}{#1}}}
\def\myoutput#1{{\fontsize{9}{9.2}\selectfont\verbatimtabinput{#1}}}

\newcommand{\vs}{\varsigma}
\newcommand{\mcL}{\mathcal{L}}
\newcommand{\mcI}{\mathcal{I}}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
 
\headsep25pt\headheight20pt
 
 
\pagestyle{fancyplain}
\rhead{\fancyplain{}{\small\bfseries Blocher, Jordan}}
\cfoot{\ \hfill\tiny\sl Draft printed on \today}
 
 
\setlength{\extrarowheight}{2.5pt} % defines the extra space in tables
 
\begin{document}
\begin{multicols}{2}

\section{Abstract}

We investigate the 2cm app, a data-exchange platform published for China Mobile Hong
Kong 4G Pro Service Plan customers. Telecommunications ISPs' revenue is typically
gained by charging users a fixed fee for a maximum amount
of data usage in a month, i.e., a monthly data cap \cite{???}. 
2cm's (2nd exchange market) data exchange platform allows users to submit
bids to buy and sell data.
This usage model, is, as far as our knowledge, the first data trading
platform that allows customers to buy and sell their own data.
We describe a distributed auction mechanism for data exchange inspired by the
classic PSP throughput problem,
and prove that our distributed data exchange mechanism provides incentive
compatibility (social choice function), and that we have efficiency
using only partial valuation information of each participant in an exchange market.

In applying a distributed PSP implementation to CMHK market, we
find that
the market is able to achieve an equilibrium as the sellers and buyers have an
incentive for a collaborative exchange, and design our mechanism tp provide the functions
for effective communication between the connected users. We claim that in
this secondary market our formulation holds the desired VCG qualities through the construction of a
probable equilibrium \cite{???}. We further provide bounds on the auction duration, 
with respect to the classic throughput problem.
and provide simulated results on convergence time to support our (FIND
COMPETITVE RATIO!), and a bound
on the convergence of our mechanism. We extend the works of cite!cite!
i.e. (market influence/EQ,social EQ,payment/allocation models) OR (bandwidth, data bundles, distributed
market algorithms) and show the existence of a dynamic global market equilibrium, allowing for a unique set of market dynamics.



\section{Introduction}

In this work, we propose \emph{a distributed progressive second price (PSP) auction in
order to maximize social utility in the CMHK market}. Using the
distributed PSP mechanism on CMHKs data
exhange platform, we show that for cellular data allocated between multiple users there
exists an $\epsilon$-Nash market equilibria. A quality of the PSP auction is that
demand information is not known centrally, rather, it is distributed in the
buyers' valuations. The mechanism for an auction is defined
as \emph{distributed} when the allocations at any element depend only on
\emph{local} state: the quantity offered by the seller at that element, and the
bids for that element only \cite{lazar}. In this work, the proposed mechanism
allows the distribution of bids, where there are many ISPs each holding
thier own local auction; there is no entity that holds a global market knowledge.

In a PSP mechanism, bids consist of (i) an available (required) quantity and (ii) a unit-price (calculated
using its own demand functions). Buyers submit bids cyclically until an
($\epsilon$-Nash) equilibrium is reached and a local auction is concluded. 

(FEE IS FIXED OR
PER-UNIT?)(HOW DO WE MODEL ISP REVENUE? IMMEDIATE FUTURE)

The form of the auction mechanism presented here is (CAN BE? NEED TO SHOW TO
CLAIM 'IS') described as a
pure-strategy progressive game with incomplete, but perfect information. (WHAT
DOES NASH SAY ABOUT THIS?) (TRY MIXED? CAN ONLY HAVE MIXED WITH A DISTRIBUTED
VALUATION.. FUTURE WORK) 

The paper is organized as follows...

(MOVED: TO ORGANIZE)\\
The main contribution of this work 
is an auction mechanism inspired by the classic PSP throughput problem. In
order to apply a distributed PSP implementation to the CMHK market,
we analize the behavior of users in a dynamical data exchange market. As both buyers and sellers are able
to change their bid strategies, and as each user only has \emph{local}
information about the bidding environment, it is clear that an unconstrained
market, even with a finite number of users, could suffer from the communication
expense from numerous local auctions trading an infinitely divisible resource.
We will assume that the cost of participating in the CMHK secondary market is
absorbed by the bid fee, which could represent data used in submitting bids, or
a fee charged per unit of data, or a flat rate charged at the completion of the
purchase. It is worth mentioning that CMHK users are not allowed to resell data
purchased from the CMHK
market, additionally, the purchased data does not carry to the next
service period. Therefore, a market equilibrium, where
supply equals demand, requires that users maintain incentive for truthfullness
across a distributed setting.
We complete a comprehensive analysis of market dynamics, (FINISH)
To the best of our knowledge, this is the first work to provide a truthful
mechanism in a distributed setting for data-exchange based on market behavior.
\\
\textbf{Remark:} It is certainly possible to extend the mechanism, alleviating the
restrictions introduced by the CMHK secondary market. We reserve this for
future work.

We claim that the CMHK market is
able to achieve an equilibrium as the sellers and buyers have an
incentive for a collaborative exchange, and as our mechanism provides
for effective communication between the connected users. 

Despite the small message space, with many user types, there is no single
way to do the transformation from the direct revelation mechanism to the
desired one. Our mechanism is naturally designed by guessing
right direct-revelation-to-desired-mechanism transformation and building it
into the allocation rule to be the primary step in the design. This incentive for a user to
truthfully reveal its type is built into the user strategies. As in classic
mechanism design, we determine the equilibria as result of incentive
compatibility in our mechanism design. 
We claim that in the CMHK market our formulation not only holds the desired VCG qualities,
but minimizes comminication overhead 
and auction duration, resulting in a convergence time (FIND COMPETITIVE RATIO?)
with respect to the classic throughput problem. 


This is the (built-in) transformation from the
direct-revelation mechanism to the desired message space.

\subsection{Distributed Progressive Second Price Auctions}

Progressive second price auctions (PSPs) were proposed
in \cite{lazar}, \cite{diffserve} to provide a dynamic network service pricing
scheme to provide consistent services for network bandwith users.
\cite{diffserve} conducts a game theoretic analysis, deriving
optimal strategies for buyers and brokers, and further shows the existence
of networkwide market equilibria based on their game-theoretic
model. Constructing necessary and sufficient conditions for the stability
of the game allows the sustainability of any set
of service level agreement configurations between Internet service
providers.

We begin with a brief introduction to the distributed PSP auction for bandwith
sharing, first introduced by Lazar and Semret \cite{lazar}.
We define a set of $\mcI = \lbrace 1,\cdots,I\rbrace$ network bandwidth users.
Suppose each user $i \in \mcI$ makes a bid $s_i^j = (p_i^j, d_i^j)$ to the
seller of resource $j$, where $p_i^j$ is the unit-price the user is willing to
pay and $d_i^j$ is the quantity the user desires. The \emph{bidding profile} forms a grid, $s \equiv
[s_i^j] \in \mcI \times \mcI$, and $s_{-i} \equiv [s_1^j , \cdots , s_{i-1}^j , s_{i+1}^j , \cdots
, s_I^j]_{j\in\mcI}$ is the profile of user $i$'s opponents. 
Using this classic PSP mechanism, \cite{lazar} shows that given the opponents
bids $s_{-i}$,
user $i$'s $\epsilon$-best response to seller $j$ is $s_i^j = (w_i^j, v_i^j)$
and is a Nash move
where $\epsilon > 0$ is the bid fee, $B_i =\sum_{j\in\mcI} b_i^j$ is user $i$'s
budget, and every user has an elastic demand function.
Based on the profile of bids $s^j = [s^j_1, \cdots , s^j_I]$, the seller applies
an allocation rule $a(s^j) = [a_1^j, \cdots , a_I^j]$, where $a^j_i$ is the quantity allocated
by $j$ to each user $i\in\mcI$ and $c^j_i$ is the cost charged to $i$ for
allocations awarded in auction $j$. 
An allocation is considered feasible if $a^j_i \le d_i^j$, and $c^j_i \le  p^j_i d_i^j$.

% MECHANISM
\subsubsection{The PSP Mechanism}\label{mechanism}
The PSP auction as given in \cite{lazar} and \cite{semret} is designed for the
problem of network bandwidth allocation, and is analyzed as a noncooperative
game where $i\in\mcI$ agents buy the
fixed amount of bandwidth $d_i^j$ from sellers $j\in\mcI$.
The market price function (MPF) for a buyer-seller pair is,
% NEW MARKET PRICE
\begin{align}\label{dataprice}
\begin{split}
    P_i^j(z, s_{-i})= \inf\bigg\lbrace y\ge 0 : 
    d_i^j - \sum_{p_k^j>y,k\ne i} d_k^j \ge z \bigg\rbrace,\\
\end{split}
\end{align}
and is the of minimum prices a user bids in
order to obtain bandwidth $z$ given opponent profile $s_{-i}$. 
The maximum available quantity of data in auction
$j$ at unit price $y$ given $s_{-i}^j$ is,
% NEW INVERSE DEMAND
\begin{align}\label{datapriceinverse}
\begin{split}
    D_i^j(y, s_{-i}) &= \bigg\lbrace D^j - \sum_{p_k^j>y,k\ne i} d_k^j  \bigg\rbrace,
\end{split}
\end{align}
where $D^j$ is the total amount of bandwith that user $j$ has to offer.
% DATA ALLOCATION RULE
For each $i \in \mcI$, the allocation from auction $j$ is,
% and so for profile $s_i$, for any $i \in \mcI$,
\begin{align}\label{dataallocation}
    a_i^j(s) &= \min\bigg\lbrace d_i^j, 
    \frac{d_i^j}{\sum_{p_k^j= p_i^j}d_k^j} D_i^j(p_i^j,s_{-i}^j)\bigg\rbrace.
\end{align}
Finally, we have the cost of the allocation,
% DATA COST
\begin{align}\label{datacost}
    c_i^j(s) = \displaystyle\sum_{k\ne i} 
p_k^j \big[a_k^j(0; s_{-i}^j)
    -a_k^j(s_i^j;s_{-i}^j)\big].
\end{align}

It was shown, in \cite{lazar}, that the mechanism may converge to a Nash market
equilibria for differentiated services
allocated between multiple agents when all players bid their real marginal valuation
of the bandwidth resource. In other words, the PSP constraints are
sufficient to attain the desirable property of truthfullness through incentive
compatibility. The pricing mechanism upholds the \emph{exclusion-compensation
principle}, user $i$
pays for its allocation so as to exactly cover the ``social opportunity cost"
which is given by the declared willingness to pay (bids) of the users who are
excluded by $i$'s presence, and thus also compensates the seller for the maximum lost potential
revenue \cite{lazar}.
The PSP rules assume that an agent's valuation is represented by an elastic valuation function.
\definition{\cite{lazar}}
A real valued function, $\theta(\cdot): [0,\infty) \rightarrow [0,\infty)$, is an \emph{(elastic) valuation
function} on $[0, D]$ if 
\begin{itemize}
    \item $\theta(0) = 0$,
    \item $\theta$ is differentiable,
    \item ${\theta}' \ge 0$, and ${\theta_i}'$ is non-increasing and continuous,
     \item There exists $\gamma > 0$, such that for all $z \in [0,D]$,
${\theta}'(z) > 0$ implies that for all $\eta \in [0, z), {\theta}'(z) \le
{\theta}'(\eta)
- \gamma(z - \eta)$. 
\end{itemize}
The function $\theta'(\cdot)$ on $[0, D]$ is called an (elastic) demand
function.
In the PSP market, a
user is considered truthful if their bid price equals their marginal valuation,
i.e. $p_i^j = {\theta_i^j}'$.


\section{Related Work}

\section{The Problem Model}


\subsection{The CMHK Market}

We construct the model for a PSP data auction for mobile users
particpating in CMHK's secondary data-sharing market.
Define $\mcI = \lbrace 1, \cdots, I\rbrace$ as the set of users who purchase or sell
data from other users. We again define the bidding profile for any user to be 
$s \equiv
[s_i^j] \in \mcI \times \mcI$, and $s_{-i} \equiv [s_1^j , \cdots , s_{i-1}^j , s_{i+1}^j , \cdots
, s_I^j]_{j\in\mcI}$ as the profile of user $i$'s opponents. 
As a cellular network is fully connected, we assume that a buyer submits bids directly to sellers via the
cellular network. We assume that users are selfish, and therefore
rational. 
Users prefer to participate in the CMHK secondary market as it allows them to purchase
additional data for a cost less than the overage fee set by the ISP. 
Thus we assume that all users submit bids in order to maximize their
(private) valuation functions. 
In general, user preferences are defined by a utility function, $u$, which 
represents a users' valuation of an allocation minus the price.
Absent the cost or revenue from trading data, CMHK users gain utility from consuming
data. 
We assume that data is a unary resource belonging to the seller, and
therefore we identify each local auction with the identity of the seller
$j\in\mcI$, and that the user valuation
\iffalse
is independently and identically
distributed (i.i.d.) and
\fi
satisfies the conditions for an
\emph{elastic demand function}, as in \cite{lazar}.
Finally, we assume in the CMHK market that a buyers' budget is always
sufficient, as the alternative is to pay the overage fee to the ISP.

The CMHK market does not allow for brokers \cite{cmhk}, we thereby determine that
the bid profiles must adhere to some additional restrictions, which we will
imply using the PSP bid profile notation. In other words, we assume that buyers and sellers are
separated (a seller does not also buy data and vice versa). Thus, we may assume
that this is implied in our notation.
A user's identity $i \in \mcI$ as a \textbf{subscript} indicates that the bid
belongs to a \textbf{buyer}, and a \textbf{superscript}, $j\in\mcI$, indicates
the bid belongs to a \textbf{seller}.
Suppose $i$ is buying from $j$. The bid is represented by $s_i^j = (d_i^j, p_i^j)$, 
meaning $i$ would like to buy from $j$ a quantity $d^j_i$ and is willing to pay
a unit price $p^j_i$. Without loss of generality, we assume that all users bid in all
auctions; if a user $i$ does not submit a bid to $j$, or vice versa, we simply set $s_i^j =
(0,0)$. Naturally, in a live auction, if a buyer does
not submit a bid to a seller, then this implies $s_i^j = 0$ for both buyer $i$
and seller $j$. Obviously, a buyer that does not submit a bid will not recieve opponent profiles from seller
$j$. For the purposes of our analysis, we will assume that a zero bid from a
buyer is equivalent to no bid.
A seller $j$ submits a bid $s_i^j = (d_i^j, p_i^j)$ to the secondary market,
with the intent of offering a
quantity $d_i^j \in d^j = [d_i^j]_{i\in\mcI}$ 
with reserve unit price $p_i^j \in p^j = [p_i^j]_{i\in\mcI}$ to buyer $i$. We emphasize that we allow for $s_i^j$ to
stand for a buyer or sellers' bid, the \emph{direction} of the bid (vector) is determined
by the user type, whether or not they are  a buyer or a seller. 
To further clarify our analysis, we will emphasize the separation of buyers and
sellers using
$s_i$ and $s^j$, indicating if a bid is from a buyer or a seller.
In other words, a bid $s^j =
[s_i^j]_{j\in\mcI}$ is understood as an offer of data by seller $j$ in the CMHK
secondary market. The notational conventions of the bid vectors are essentially 
slices of the grid, $s^j = [s_i^j]_{i\in\mcI}$ denotes a sellers' profile, and $s_i =
[s_i^j]_{j\in\mcI}$ denotes a buyers' profile. 
Furthermore, noting that this is a simplification for ease of notation, we let $D^j = \sum_{i\in\mcI}
d_i^j$ be the total amount of data $j$ has to sell, and $D_i = \sum_{j\in\mcI}
d_i^j$ represent the
total amount of data requested by buyer $i$. 

Consider the grid of bid proiles, $s$, representing the distributed PSP auction
mechanism in the CMHK market, each buyer $i$ will
have information from each seller $j$, as well as opponent profiles $s_{-i}$
from each auction in which it is participating, and therefore
in the extreme case, where $i$ submits bids to all auctions $j\in\mcI$, buyer
$i$ gains access to the full grid $s$. However, 
sellers can only gain information about the market grid by observing buyer
behavior in their local auction.
In our current formulation, we do not allow a seller to host multiple
auctions(FUTURE WORK?). Thus, the buyers are able to directly and globally
influence the CMHK market dynamics, with the sellers taking a secondary role
(FIND IN ANOTHER PAPER FOR SUPPORT OR OBVIOUS ENOUGH?).



\subsection{User Behavior}

We assume that the CMHK market does not have network
bottlenecks, which is purely a bandwidth problem, as in \cite{semret}, and as
bandwidth in wireless networks is not the focus of this paper. We
conduct a comprehensive analysis, deriving a globally optimal strategy suited for
users with local information in a distrubuted data-sharing model. 
Users in the CMHK market do not need to bid on a complete ``route", as in the
bandwidth allocation problem \cite{semret}. Instead, our mechanism allows a buyer
to \emph{opt-out} of auctions by submitting zero bids. This strategy maximizes
utility while minimizing the number of positive bids submitted to the overall
market. We define an \textbf{opt-out function}, associated with a buyer $i$ as
part of its type. Buyer $i$, when determining how to aquire a possible allocation $a$,
will determine its bid quanities by,
\begin{equation}\label{opt-out}
    e_i(a) = [e_i^j(a)]_{j\in\mcI}.
\end{equation}
In a general sense, this abstraction applies our \emph{user strategy}
to the PSP rules.
% OPT-OUT BUYER
We define each buyer as a user $i\in\mcI$ with quasi-linear utility
function $u_i = [u_i^j]_{j\in\mcI}$, a buyers' utility function is now of the form,
\begin{equation}\label{buyerutility}
    u_i = \theta_i \circ e_i(a) - c_i,
\end{equation}
where the composition of the elastic valuation function $\theta_i$ with $e_i$ acts as a distribution function, splitting
the buyers' valuation of allocation $a$ across local markets (and thus multiple sellers).
In this way we extend the PSP rules described
in \cite{semret} to design equilibria across subsets of local data-exchange markets.

The sellers, $j\in\mcI$ are not associated with an opt-out function, we
consider their valuation to be a functional extension of the buyers, where
$\theta^j$ is constructed by buyer demand.
The sellers strategy can only be to determine the reserve price of their local
auction, using only information from buyers who have not opted out.
In our analysis, we demonstrate market dynamics, and further show evidence of symmetry in the strategies of
buyers and sellers.

\subsubsection{Market Dynamics}
The buyer demand largely motivates the market price function, however, the
distributed nature of the market prevents any single user from knowing the
market demand for a quantity of data. All users have knowledge of market
supply, as this is public information, however only buyers
are able to determine supply or demand across multiple auctions after time $t=0$, and then only from auctions
in which they participate. \\
\textbf{Remark:}
It is possible that a seller would be able to derive information about other
auctions by examining buyer bids over time, particularly if the seller had knowledge of the
buyer strategy. (FUTURE WORK?)\\
In order to represent the public platform of the secondary market, we model the ISP as
a kind of buyer $\kappa$ who remains at time $t=0$, i.e. does not participate
in any auctions. At time $t=0$, a seller $k$ entering the market will have submitted bid
$s_\kappa^j =(\epsilon, D^j)$ to the CMHK platform.

A given demand may lead to diffent prices, which emerge directly from the users valuation
of the resources and, possibly, their decision strategies. The seller does not
require a priori demand information.
It is worth mentioning that the \emph{analysis} of the auction as
a game assumes some forms of demand and supply, to derive properties.
The mechanism itself does not require any knowledge of user demand or
valuation. 
\iffalse
The ISP overage
charge inducing an upper bound on the sellers' reserve prices implies that
supply will always be greater than demand, thereby reducing the sellers'
influence on market dynamics.
\fi

As the buyer valuation is elastic, even infinitesimal changes in the market dynamics can be
modeled. This, and the homogenous nature of data in the CMHK market, 
allows for the analysis of additional constraints imposed by the user
strategies. Thus our motivation to begin our analysis with buyer valuation $\theta_i$.
A buyers' valuation of an amount of data represents how much a buyer is willing
to pay for that amount. 
This is equivalent to the bid price that
satisfies $\theta_i$ given a fixed amount of data. We determine the
buyers' utility-maximizing bid given quantity $z\ge0$ to be a mapping to the lowest
possible unit price. We have,
% BUYER PRICING 
\begin{equation}\label{buyerinversedemand}
    f_i(z) \triangleq \inf\big\lbrace y\ge 0:
        \rho_i(y) \ge z, \ \forall \ j \in \mcI\big\rbrace,
\end{equation}
where $\rho_i(y)$ represents the demand function of buyer $i$ at bid price
$y\ge 0$, and gives the quantity that buyer $i$ would buy at a given price.
We determine that the market supply function is equivalent to buyer demand, and 
acts as an ``inverse" function of $f_i$. We have, for bid price $y\ge 0$,
% BUYER DEMAND 
\begin{equation}\label{datasupply}
    \rho_i(y) = \sum_{j\in\mcI : p_i^j\le y} D^j.
\end{equation}
We note that $f_i$ is such that
$i$ could still bid in \emph{any} auction $j\in\mcI$.
Therefore, in a coordinated bid, the utility-maximizing bid price is the
lowest unit cost of the buyer to participate in all auctions, and corresponds to
the maximum reserve price amongst the sellers. We will later show, in Proposition
\ref{buyercoordinate}, that a buyer does not lose utility from coordinating its
bids, i.e. using the same bid for all auctions.
Using buyer bid quantity $e_i^j(a)$, from (\ref{opt-out}), 
we have the following Lemma,
{
% BUYER CONSTRAINTS
\lemma{(Buyer constraints)}\label{buyerconstraints}
Let $i\in\mcI$ be a buyer with bid, $s_i = (e_i(a), p_i)$, which must obey
the following constraints,
\begin{equation}\label{buyercapmax}
    \sum_{j\in\mcI} e^j_i(a) \le D_i,
\end{equation}
and, as $i$ is rational, and therefore utility-maximizing, $i$ must have
sufficient bids $s_i^j > 0$ so that,
\begin{equation}\label{buyercapmin}
    \sum_{j\in\mcI} d^j_i \ge D_i,
\end{equation}
where $d_i^j$ denotes the bid quantity of seller $j$.
}\\
\textbf{Proof:}
A rational buyer does not want to purchase extra data, as this would be
equivalent to overpaying, and so (\ref{buyercapmax}) holds. We also assume that
$i$ wants to fufill their data requirement, and so (\ref{buyercapmin}) implies
that $i$ submits positive bids to a set of buyers that will be able to fufill
their demand.

The seller is similarly represented, however a seller only has
information from buyers in its own auction, and may only be indirectly influenced by
buyers in other auctions. So from the perspective of the
seller we have a more direct interpretation of valuation as revenue.
We determine the demand function of seller $j$ at reserve price $y\ge 0$ to be,
% BUYER DEMAND 
\begin{equation}\label{datademand}
    \rho^j(y) = \sum_{i\in\mcI : p_i^j\ge y} e_i^j(a), 
\end{equation}
and define the ``inverse" of the buyer demand function for seller $j$ as
potential revenue at unit price $y$, we have, 
% SELLER REVENUE 
\begin{equation}\label{sellerinversedemand}
    f^j(z) \triangleq \sup\big\lbrace y\ge 0:
        \rho^j(y) \ge z, \ \forall \ i \in \mcI\big\rbrace,
\end{equation}
and, unsurprisingly, $f^j$ maps quantity $z$ to the highest possible unit data
price. Now, we determine that, in addition to some natural constraints, the sellers' highest
``possible" price is conditioned by
additional restrictions on its pricing function, the motivation for which is
that a buyer has the choice to opt-out of any auction, and so seller $j$ has an
incentive to set its reserve price to include enough buyers to sell all its
data. Thus we have the following Lemma,
{
% SELLER CONSTRAINTS
\lemma{(Seller constraints)}\label{sellerconstraints}
Let $j\in\mcI$ be a seller with bid $s^j$, then $j$ must obey the following constraints.
A bid $s_i^j= (d_i^j, p_i^j)$, to buyer $i$ must be such that,
\begin{equation}\label{datacapmax}
    \sum_{i\in\mcI} d^j_i \le D^j,
\end{equation}
In addition, for a rational seller, the reserve price must
satisfy, $\forall \ i\in \mcI$,
\begin{equation}\label{reservepricemin}
   p_i^j \ge \min_{i\in\mcI}\big(p_i^j),
\end{equation}
and,
\begin{equation}\label{reservepricemax}
   p_i^j \le \max_{i\in\mcI}\big(p_i^j).
\end{equation}
Finally, as $j$ is rational, $j$ must submit enough bids $s_i^j >0$ so that,
\begin{equation}\label{datacapmin}
    \displaystyle\sum_{i\in\mcI} e_i^j(a) \ge D^j.
\end{equation}
}\\
\textbf{Proof:}
The first statement is obvious, 
a seller cannot sell more data than they have,
Then, (\ref{reservepricemin})
follows from the assumption that $j$ is rational, and so utility-maximization
acts as revenue maximization, a rational seller will not sell its
data at a price less than the lowest offer. Finally, as a rational seller will
attempt to maximize profit, and will try and sell all of its data, and so we
must have sufficient demand
from the buyers. Therefore, (\ref{reservepricemax}) and (\ref{datacapmin}) hold. Together, (\ref{datacapmax}) and
(\ref{datacapmin}) address the case where $\sum_{i\in\mcI} e_i^j(a) >  D^j$. In
this case, by (\ref{dataallocation}), $j$ may submit a partial bid to a buyer
$i$ so that $\sum_{i\in\mcI} d^j_i = D^j$.

We proceed to determine the properties and characteristics of the user valuation functions. Buyer $i$'s valuation is interpreted as a unit valuation $\theta_i$,
distributed across the CMHK market via bids in local auctions. 
As such, buyer behavior is influenced by opponent bid profiles from multiple auctions.
We therefore determine that the valuation of any user must be modeled as a function of the entire
marketplace. Naturally, a buyers' valuation is aggragated over local markets, and the
sellers' valuation is aggragated over its own auction. We model the valuation of
users based on the opt-out user behavior, thereby including the buyers'
influence on the market. We have already introduced the composition $\theta_i
\circ e_i$ as the valuation of the buyers. We further model the valuation of the sellers, based on
(\ref{datademand}) and (\ref{sellerinversedemand}). We first note that, in
general (and so we omit the subscript/superscript notation), the valuation of data quantity $x\ge 0$ is given by,
$$
    \theta(x) = \int_0^x f(z) \ dz,
$$ 
as in \cite{semret}. Now, we have the following Lemma,
{
\lemma{(User valuation)}\label{uservaluation}
For any buyer $i\in\mcI$, the valuation of a potential
allocation $a$ is, 
\begin{equation}\label{buyervaluation}
    \theta_i \circ e_i(a) = \displaystyle\sum_{j\in\mcI}
 \int_0^{e_i^j(a)} f_i(z) \ dz.
\end{equation}
Now, we may define seller $j$'s valuation in terms of revenue, so we have,
\begin{equation}\label{sellervaluation}
    \theta^j= \displaystyle\sum_{i\in\mcI} \theta^j \circ e_i^j(a) = \sum_{i\in\mcI}
 \int_0^{e_i^j(a)} f^j(z) \ dz.
\end{equation}
}
\textbf{Proof:} 
We assume that a buyer wants to minimize the cost of purchasing their data
requirement, at the same time ensuring they get the full allocation $e_i(a)$,
and so must minimally meet $j$'s reserve price. 
A seller will try to maximize profit, 
and so will try to sell all of its data.  By Lemma
\ref{buyerconstraints} and Lemma \ref{sellerconstraints}, we have,
$d_i^j = e_i^j(a) \Rightarrow \sum_{i\in{\mcI}} d_i^j =
\sum_{i\in\mcI} e_i^j(a) = D^j = D_i$. It is worth observing that this result
does \emph{not} imply that $s_i=s^j$. Let $\xi$
be a unit of data from buyer bid quantity $e_i^j(a)$.
If $\xi$ decreases by incremental amount $x$, then seller bid $d_i^j$ must
similarly decrease. The lost potential revenue for seller $j$ is the price of
the unit times the quantity decreased, by definition, $f^j(\xi)x$, and so,
$$
    \theta^j(\xi) - \theta^j(\xi-x) = f^j(\xi)x.
$$
Thus (\ref{sellervaluation}) holds.
As we may use the same argument for (\ref{buyervaluation}), we complete the
proof with the observation that the function $f^j$ (resp. $f_i$) is the first
derivative of the valuation function with respect to
quantity, and therefore, in this context, represent the marginal valuations of the
users, ${\theta^j}'$ (resp. $\theta_i'$). Finally, the sellers' natural utility is the potential
profit, or simply $u^j = \theta^j$, where we have chosen to omit the original cost of the data
paid to the ISP, as it is not a component of our mechanism, and as a discussion
of mobile data plans is outside the scope of this paper.  

\subsubsection{Buyer Strategy}

Although it is possible for a seller to fully satisfy a buyer $i$'s demand, it
is also reasonable to expect that a seller may come close to using their
entire data cap, and only sell the fractional overage. In this case, we
determine that some buyers must split their bids among multiple sellers. 
We propose the following strategy to determine when rational
(utility-maximizing) buyers will opt-out of a local auction. (QUESTIONING WHETHER OR NOT $\mcI_i$ SHOULD
BE ORDERED BY DATA, OR IF PRICE IS BETTER, PRETTY SURE IT IS OK, WILL FIND OUT
IN LATER PROOFS)
% BUYER STRATEGY
{
\proposition{(Opt-out buyer strategy)}\label{buyerstrategy}
Define any auction duration to be $\tau \in [0,\infty)$. 
Let $i\in\mcI$ be a buyer and fix all other buyers' bids $s_{-i}$ at time
$t\in\tau$. % For any allocation $a$ at time $t$, let
% OPT-OUT BUYER STRATEGY
%\begin{equation}\label{opt-out}
    %e_i^j(a) \triangleq \frac{a_i^j}{\vs_i^j} 
    %e_i^j(a) \triangleq a_i^j,
%\end{equation}
%and define,
Define the composition,
$$
     e_i^j \circ a = e_i^j(a) = \frac{a_i^j}{j},
$$
to be the buyer strategy with respect to quantity, and the set,
% MIN SET
$$
    \mcI_i(n) =\argmax_{\mcI' \subset \mcI, \vert\mcI'\vert =
n}\sum_{j\in\mcI'} D^j,
$$
where buyer $i$ chooses its seller pool by determining $n$, where
\begin{equation}\label{buyercoordinate}
    %n = \argmin_{\ell_i}(j \in \ell_i : \displaystyle\sum_{n} \frac{d^n}{d_i}
    %n = \argmin_{\ell_i}(j \in \ell_i : \displaystyle\sum_{n} d^n
    n = \min( j\ \vert\ j\in \mcI_i(n): j D^j\ge D_i),
\end{equation} 
The buyer strategy produces a minimal subset of sellers $\in \mcI$ 
able to satisfy buyer $i$'s demand. For 
fixed $n$ we will denote this subset,
\begin{equation}\label{sellers}
    \mcI_i \subset \mcI.
\end{equation}  
Now let $j^* = n \le I$ represent the seller with the least amount of data
$\in\mcI_i$, i.e. $D^{j^*} \le D^j, \ \forall\ j \in\mcI^j$, and define $i$'s bid
vector $e_i$ with respect to its strategy, where
\begin{equation}\label{opt-minallocation}
    e_i^j(a) \triangleq \begin{cases} e_i^{j^*}(a), \quad j\in\mcI^j,\\
            0, \quad j\ni\mcI^j.\end{cases}
\end{equation}
Now, (\ref{opt-minallocation}) holds $\forall \ j\in\mcI$,
and we have that $e_i$ defines an optimal feasible strategy for buyer $i$.
}\\
\textbf{Proof:}
We assume that a buyer will try and fill their data requirement.
In the case that there exists a seller who can completely satisfy a buyers'
demand, $j^*=1$, $\vert \mcI_i\vert =1$ and (\ref{buyercoordinate}) holds. If such a buyer does not exist,
as the set $\mcI_i$ is ordered by the quantity of the sellers' bids, $i$ may discover 
$j^*$ by computing $\mcI_i$.
Suppose that $D_i >
\sum_{j\in\mcI}D^j$, then $j^* > I$ and $\mcI_i = \emptyset$. 
We model the ISP at time $t>0$ as a seller $\kappa$ with bid $s^\kappa =(d^\kappa, p^\kappa)$,
where $d^\kappa > D^j, \
\forall \ j\in\mcI_i$, and
$p^\kappa$ represents the overage fee for data set by the ISP, which we note is also the upper bound of the sellers'
pricing function, and so again (\ref{buyercoordinate}) holds.
Now, consider some $k \ne i \in \mcI$ where $p_i^j = p_k^j$. 
The allocation rule (\ref{dataallocation}) determines that the data will be
split proportionally
between all buyers with the same unit price. 
It is possible that the resulting partial allocation of data to $i$ and $k$
would not satisfy some demand. As the two cases $i$ and $k$ are the same, we
will only consider one. Suppose seller $j$ updates its
bid to reflect the new data quantity, $j$'s bid quantity at time $(t+1)$,
$d_i^{j(t+1)}$, is such that
$d_i^{j(t+1)} < e_i^{j(t)}(a)$ where $e_i^{j(t)}(a)$ is $i$'s bid at time $t$.
Then, by the definition of $\mcI_i$, once the buyer implements its strategy, we can
only have that $j \ni \mcI_i$, or that $n$ has been increased so that and new seller(s)
enter the pool. 
Additionally, we consider the entrance of a new buyer $k$ at time $(t+1)$, where $p_k^j > p_i^j, \ \forall \ j \ \in \mcI_i$, in other
words, a new buyer $k$ may enter the market with a better price, decreasing the
value of $i$'s bid for sellers $\in\mcI_i$. In this case, by (\ref{buyercoordinate}), $i$ will increase the value of
$n$ so that
$$
    e_i^{j(t+1)}(a) = e_i^{j(t)}(a) - e_k^{j(t)}(a),
$$
and the subset $\mcI_i$ is large enough to balance the additional demand from
$k$. Thus, as in each case we have that $i$ is able to satisfy thier demand,
and we determine that the opt-out strategy is optimal. We note that feasibility
is not addressed here, as we provide this analysis in Section \ref{???}.

Finally, we note that $\mcI_i$ is not the only
possible minimum subset $\in\mcI$ able to satisfy $i$'s demand, it is the
minimal ordered subset where a
coordinated bid is possible, the reasoning for which we will address in Section
\ref{analysis}. 

\subsubsection{Seller Strategy}
(POSSIBILITY OF SWITCHING TO BUYER POOL ORDERED BY DATA, IF SELLER POOL GETS
SWITCHED TOO)
In order to to develop the seller strategy, we examine the incentive of a
rational seller with only local information in a dynamic market of many
buyers and sellers. A local auction, examined independently, may appear as
single market with a single seller and many buyers, but is in fact a subset of the
larger data-exchange market, and is subject to the trends and dynamics
therewithin. A seller must determine allocations using only bids in its local market, while the buyers' response is based on the
allocations and resulting opponent bids from all auctions in its seller pool.
In addition, buyers are allowed to bid both dynamically and asychronously. 

In order to
maximize revenue, the seller must also be able to respond dynamically to
address the mutation of competitive bids in its market. In order to do this, we
determine that the seller may modify its reserve price in response to the
changing market dynamics. (MORE!)
We will show that sellers are able to maximize revenue in restricted subset of
buyers in $\mcI$, and as such will attempt to facilitate a local market
equilibrium for this subset.  

We describe the sellers' \emph{local} auction strategy for allocating its
data according to the constraints formed by the buyer strategy. A
local auction may be described as a progressive game of strategy with
incomplete, but perfect information, however in our analysis, as before, we will assume
complete information.
(BUYERS ARRIVE AS A POISSOIN PROCESS? FUTURE WORK)

% SELLER LOCAL STRATEGY
{
\proposition{(Localized seller strategy (i.e. progressive allocation))}\label{sellerstrategy}
Define any auction duration to be $\tau \in [0,\infty)$. 
For any seller $j$, fix all other bids $[s_i^k]_{i,k\ne j \in\mcI}$ at time $t\in\tau$.
Define
$$
    \mcI^j(n) =\argmax_{{\mcI}' \subset \mcI, \vert{\mcI}'\vert =
n}\sum_{i\in{\mcI}'} p_i^j,
$$
where,
\begin{equation}\label{sellercoordinate}
    n = \min( i \ \vert \ i \in\mcI^j(n) : \displaystyle\sum_{i\in\mcI} d_i^j \ge
D^j),
\end{equation} 
The determination of $n$ produces a minimal subset 
of buyers that maximizes $j$'s revenue at time $t$, which we will
denote, for fixed $n$, by,
\begin{equation}\label{buyers}
    \mcI^j \subset \mcI.
\end{equation} 
Define buyer $i^* = n-1 \le I$ as the buyer with the maximum price $\ni
\mcI^j$.
Then, for time $(t+1)$, set $j$'s reserve price to be, 
\begin{equation}\label{newprice}
    p_i^j = p_{i^*}^j + \epsilon,
\end{equation}
Let the winner at time $t$ be determined by,
\begin{equation}\label{winner}
    \bar{i} = \displaystyle\max_{i\in I^j} p_i^j,
\end{equation}
and update $j$'s total data to reflect the (tentative) allocation,
\begin{equation}\label{newbudget}
    D^{j(t+1)} = D^{j(t)} - e_{\bar{i}}^{j(t)}(a),
\end{equation}
Allowing $t$ to range over $\tau$, we have that (\ref{winner}) -
(\ref{newbudget}) produces a local market equilibrium. 
}\\
\textbf{Proof:}
We assume that the seller has enough data to satisfy at least one buyer,
and that they want to maximize their revenue.
In the case of multiple buyers $i^*$ is the \emph{losing} buyer with the highest unit
price offer, determined by (\ref{sellercoordinate}), 
Suppose that for some $i\in\mcI^j$, buyer demand is not met. 
In this case, by (\ref{}) the seller must notify $i$ of a
fractional allocation by changing the bid vector at index $i$.
With this caveat, and Proposition \ref{buyerstrategy}, we have that the
aggragate demand of subset $\mcI^j$ is satisfied by seller $j$, as in Lemma
\ref{sellerconstraints}.
Although the buyers' valuation $\theta_i$ is not known to the seller, we will assume
that buyers are bidding truthfully, and so ${\theta_i}' + \epsilon
=p_i^j + \epsilon$.
Now, using
(\ref{sellervaluation}), we have, $\forall \ z\ge 0$,
\begin{align*}
    \int_0^{e_{i^*}^j(a)} f_{i}(z)\ dz &\le\int_0^{e_i^{j}(a)}
f^{j}(z) \ dz 
\end{align*}
and so,
$$
     \theta_i \circ e_{i^*}(a) \le \theta_i \circ e_i(a),
$$
which holds $\forall \ j \in \mcI_i$.
It follows that, using
%, using (\ref{buyercoordinate}), 
the definition of an $\epsilon$-best reply $s_i^j = (v_i^j, w_i^j)$,  
for any $\epsilon$-best reply, 
$$
    p_i^j \le {\theta_i}'(v_i^j) + \epsilon,
$$
$\forall i \in \mcI^j$.
Therefore the choice of $p_i^j$ does not force any buyers out of the local
auction. Thus we determine the valuation between seller
$j$ and buyer $i$ is well-posed, the reserve price (\ref{newprice}) is justified, and the local
equlibirium created by $j$ is stable from time $t$ to $(t+1)$. 
We note the special case where for winner $\bar{i}$, $\ \exists \ k\in\mcI^j$
such that $p_{\bar{i}}^j =
p_i^k$. In this case the seller again notifies the buyers of a fractional
allocation by changing $d_i^j$ and $d_k^j$ to reflect the proportional
division. Finally, in the case where winning buyer(s) \emph{opts-out} of the local
auction, where $j\in\mcI_i$ at time $t$, then at time $(t+1)$ $j\ne \mcI_i \Rightarrow s_i^{j(t+1)} = (0,0) \Rightarrow i \ne
\mcI^j$, which is mathematically analogous to the definition of opting-out in our
scenario. The seller may simply return the tentatively allocated data to $D^j$,
and recompute $\mcI^j$ and $p_{i^*}^j$, 
$$
    D^{j(t+1)} = D^{j(t)} + \displaystyle\sum_{i\in\Gamma} d_i^{j(t)}
$$
where $\Gamma$ represents the buyers who have opted-out from time $t$ to 
$(t+1)$, indicated by a zero bid from any buyer $\in \mcI^j$:
$$
    \Gamma = \lbrace i\in \mcI^j : s_i^{j(t+1)} = 0\rbrace.
$$

(NOTE - NEED TO SAY MORE HERE... INDUCTION? HOW DOES THE TENTATIVE AWARD WORK IN
FRACTIONAL ALLOCATIONS? SAVE FOR NASH EQ PROOF? KEEP WITH t TO t+1?)

\subsubsection{Market Dynamics under Strategy}

We conclude this section by examining the relationship between the strategies of buyers and
sellers in local auctions. We model the impact of the dynamics of the
data-exchange market on a local auction $j$. As we have shown, the seller
is a functional extension of the buyer, with rules determined by the buyers'
behavior. This gives an auction $j$ a natural logical extension into the
global market through its buyers. We demonstrate that the symmetry between
buyer and seller rules stretches into a symmetry across subsets of local
auctions. Additionally, we identify a clear bound restricting the influence of
local auctions on each other. We have the following Lemma.
\newpage
% USER UNION
{
\lemma{(Valuation across local auctions)}\label{userunion}
For any $i,j\in \mcI$, 
\begin{equation}\label{jtoi}
j\in\mcI_i \Leftrightarrow i\in\mcI^j.
\end{equation}
Fix an auction $j\in\mcI$ and define the influence sets of users. 
The primary influencing set is given as,
%(ALL THE SELLERS FROM EACH BUYERS POOL)
\begin{equation}\label{lambda}
    \Lambda = \displaystyle\bigcup_{i\in\mcI^j} \mcI_i,
\end{equation}
with secondary influencing set,
%(ALL THE BUYERS FROM EACH SELLER $i$ IN $j$'s BUYER POOL)
\begin{equation}\label{llambda}
    \lambda = \bigcup_{i\in\mcI^j} \bigg(\bigcup_{k\in\mcI_i} \mcI^k \bigg)
\end{equation}
\iffalse 
(THE SELLERS ALL THE BUYERS IN $j$ HAVE IN COMMON! i.e. $j$ AND...)
\begin{equation}%\label{lambda}
    \Lambda = \displaystyle\bigcap_{i\in\mcI^j} \mcI_i,
\end{equation}
(THE COLLECTION OF BUYERS FROM EACH $i$ THAT ARE COMMON ACROSS ALL THE $i$'s SELLER
POOLS)
\begin{equation}%\label{llambda}
    \lambda = \bigcup_{i\in\mcI^j} \bigg(\bigcap_{k\in\mcI_i} \mcI^k \bigg)
\end{equation}
***********************************
\begin{equation}
    \Lambda = \bigg(\displaystyle\bigcap_{i\in\mcI^j} \mcI_i \bigg) \cup \mcI^j,
\end{equation}
\begin{equation}
    \Lambda = \mcI^j \cap \bigg(\displaystyle\bigcap_{i\in\mcI^j} \mcI_i \bigg),
\end{equation}
and for each $i\in\mcI^j$ define,
\begin{equation}
    \Lambda_i = \mcI^j \cap \bigg(\displaystyle\bigcap_{k\in\mcI_i} \mcI^k
\bigg).
\end{equation}
we have $\forall \ i \in
\mcI^j$,
\begin{equation}\label{sym}
    (\theta_i \circ \theta^j) = (\theta^j \circ \theta_i).
\end{equation}

***********************************
\fi
Fixing all bids $s_i^j \in \mcI$, and time $t\in\tau$, we have that,
\begin{equation}\label{unioneq}
    \displaystyle\sum_{j\in\Lambda} \theta^j = \sum_{i\in\lambda} \theta_i.
\end{equation}
}\\
\textbf{Proof:}
A local auction $j\in\mcI$, is determined by the collection of buyer bid
profiles, where $s_i^j > 0 \Rightarrow j\in\mcI_i$, and we have that $i\in\mcI^j$,
if and only if $i$'s bid is such that $p_i^j \ge p_{i^*}^j$, where
(\ref{sellercoordinate}) defines $i^*$ as the losing buyer with the highest bid
price in auction $j$.
Suppose $p_i^j < p_{i^*}^j$. By Proposition \ref{sellerstrategy}, $i^*$ is either included or excluded from $\mcI^j$. 
If $i^* \ni \mcI^j$, then (\ref{jtoi}) holds; in the latter case, by
Proposition \ref{buyerstrategy}, $i^*$
will add sellers to its pool until its demand is satisfied. Therefore for any
$j\in\mcI_i$, $\nexists \ s_i^j > 0$ where $i \ni \mcI^j$, and so (\ref{jtoi})
holds.
Furthermore, we note that $\lambda \subset \mcI$ is a complete and disjoint set
of bid vectors with respect to auction $j$. That is, $\forall \ i \in \mcI^j,
s_i^k > 0 \in \lambda$ if and only if $s_i^k>0 \in\mcI$, and so $s_i \in \lambda
\equiv s_i \in \mcI$. (NEED TO ADD TO LEMMA AND PROVE?)

Now, the subset $\mcI^j \subset \mcI$
determines $j$'s reserve price $p_{i^*}^j$. Assuming the buyer submits a
coordinated, truthful bid, $\mcI_i\subset \mcI$ 
will determine the unit price $p_{i}$ in buyer $i$'s bid.
The reserve price (\ref{newprice}) of seller $j$ is determined at time $t$, and is
the lowest price that $j$ will accept to perform any allocation.
Let $p_*^j = f^j \circ e_i^j(a) $ denote the reserve
price of auction $j$, noting that $p_i^j=0, \ \forall \ i \in
[p_i^j]_{i\ni\mcI^j}$, and let $p_i^*= f_i \circ e_i^j(a)$ the (coordinated) bid price of buyer $i$, i.e. $p_i^k = p_i^*,
\ \forall \ k \in\mcI_i$. 
Using (\ref{buyerinversedemand}), (\ref{sellerinversedemand}), and Proposition
\ref{sellerstrategy}, $\forall \ i \in \mcI^j$, we have that $p_i^* \ge p_*^k,
\ \forall \ k \in\mcI_i$.

\iffalse
Now, we have,
\begin{equation}\label{rho}
    \rho^j(p_*^j) \le \displaystyle\sum_{i\in\mcI^j} e_i(a(s_i^j)),
\end{equation}
from (\ref{datademand}), (\ref{buyerinversedemand}),
(\ref{sellerinversedemand}), and so $p_i^j \ge p_{*}^j \ge p_i^k, \ \forall \ i \in
[p_i^j]_{i\in\mcI^j}$ and $\forall \ k \in [p_i^k]_{k\in\mcI_i}$
\fi

The incentive of each seller $\in\Lambda$ is to sell all of its data at the
best possible price. In the simplest case,
consider a disjoint local market $j$, where $\forall \ i\in\mcI^j$, $s_i^k = 0,
\ \forall \ k\ne j \in \mcI_i \Rightarrow \Lambda = \lbrace j \rbrace$ and
$\lambda = \mcI^j$. 
Using (\ref{buyerinversedemand}) and  (\ref{sellerinversedemand}), we clearly
have that $\theta_i = \theta^j, \ \forall \ i \in \mcI^j$.
In all other cases, the sellers $\in\Lambda$ are competing to sell
their respective resources to buyers whose valuations are distributed across multiple auctions. 
%By (\ref{jtoi}), $j\in \mcI_i, \ \forall \ i\in \mcI^j$. 
The set $\lambda$ represents all of the buyers influencing auction $j$, both
directly and indirectly. 
The bid price of buyer $i\in\mcI^j$ is determined by,
\begin{equation}\label{maxbid}
    p_i^* = \max_{k\in\mcI_i}\big(f^k \circ e_i(a)\big)= \max_{k\in\mcI_i}(p_*^k).
\end{equation}
$\Lambda$ is the set of sellers that directly influence the bids of buyers
$\in\mcI^j$. the reserve price for auction $j$ is such that,
\begin{equation}\label{resprice}
    p_*^j \le \min_{i\in\mcI^j}(p_i^*) - \epsilon,
\end{equation}
by Proposition \ref{sellerstrategy}. 

We have from Proposition \ref{sellerstrategy} that $j$ maintains a local market
equilibrium at time $t$. Let buyer $i\in\mcI^j$ be the buyer in auction $j$ with the lowest bid price,
and suppose $p_i^* > p_*^j + \epsilon$. That is, $\exists \ q \in \mcI_i$ such
that $p_*^q > p_*^j$. Then, a change in $q$'s valuation from time $t$ to $t+1$ will
directly impact seller $j$. If at time $t+1$ we still have that $i$ is the
buyer with the lowest bid price, then (\ref{sellerinversedemand}) holds and
thus $j$'s valuation does not change. Otherwise a new buyer with the lowest bid will be chosen upon
recomputing $\mcI^j$, as in Proposition \ref{buyerstrategy}. 
In each case we
have that (\ref{buyerinversedemand}) and (\ref{sellerinversedemand}) hold for
fixed time $t$, and so, $\forall \ i \in\mcI^j$,
\begin{align*}
    \int_0^{e_i^j(a)} f^j(z) \ dz &= \theta_i^j \circ e_i^j(a)\\
    &= \int_0^{e_i^j(a)} f_i(z) \ dz,
\end{align*}
therefore $\theta_i = \theta^j, \ \forall \ i \in \mcI^j$.
Furthermore, it follows that,
\begin{equation}\label{jdemand}
    \displaystyle\sum_{i\in\mcI^j}\int_0^{e_i^j(a)} f^j(z) \ dz =
\sum_{j\in\mcI_i}\int_0^{e_i^j(a)} f_i(z) \ dz.
\end{equation}

Consider the set $\lambda$. For some buyer $i\in\mcI^j$, and then for
some seller $k \in \mcI_i$, we have a buyer $l \in \mcI^k$. By (\ref{jtoi}), $i,l \in \mcI^k$, and so the reserve price $p_*^k \le \min(p_l^*,
p_i^*)$, and $k, j\in \mcI_i\Rightarrow p_i^* \ge \max(p_*^k, p_*^j)$.
Suppose that $l \ni \mcI^j\Leftrightarrow j \ni \mcI_l$, so
that $p_l^* < p_*^j$. We have that
the valuation of buyer $l$ does not impact auction $j$ and vice versa, i.e. $\theta_l^j = 0$. Since $l\in\mcI^k$, $p_l^* \ge p_*^k\Rightarrow
p_*^k < p_*^j$, and $i\in\mcI^j \Rightarrow p_i^* \ge p_*^j$, and so we must
have that $p_l^* < p_i^*$,
and necessarily, $p_i^* > p_l^*$ for
any buyer $l\in\lambda$ such that $l\ni \mcI^j$. Now, suppose $\exists \ l\in\mcI^k$ such that $l\in\mcI^j \Rightarrow p_l^* \ge
p_*^j$. In the case where $p_l^* > p_i^*$, we must have that 
$\exists \ q \in \mcI_l$ such that $p_*^q > p_*^k$. % \Rightarrow \theta_l^q > \theta_l^k$. 
Again by (\ref{maxbid}), $q\ni\mcI_i \Leftrightarrow i
\ni\mcI^q \Rightarrow p_*^q >
p_i^*$, therefore $\theta_i^q = 0$, and the reserve price of auction $q$ does not effect the valuation of
buyer $i$. 
Lastly, 
in the case where $p_i^* > p_l^*$, by the same reasoning, $\theta_l^q = 0$.
We have that for any $l\in\mcI^k$ such that $l\ni
\mcI^j$, $\theta_l^j =0$, and when $l\in \mcI^j$, then either $\theta_i^q =0$
for $q\in\mcI_l$ or $\theta_l^q = 0$ for some $q\in\mcI_i$. Thus, any bid ouside of
our construction
has a zero valuation, with respect to buyers $\in\lambda$ and sellers
$\in\Lambda$. Thus, in all cases,
(\ref{buyerinversedemand}) and (\ref{sellerinversedemand}) hold.
We have,
\begin{equation}\label{idemand}
    \displaystyle\int_0^{D^k} f^k(z) \ dz = \sum_{i\in\mcI^k}\int_0^{e_i^k(a)}
f_i(z) \ dz,
\end{equation}
which holds for all buyers and sellers that satisfy (\ref{jtoi}).
Finally, using (\ref{jdemand}), (\ref{idemand}), 
\begin{align*}
    \int_0^{e_i^k(a)} f_i(z) \ dz &= \int_0^{e_i^k(a)} f^k(z) \ dz,
\end{align*}
and
\begin{align*}
    \int_0^{e_l^k(a)} f^k(z) \ dz &= \int_0^{e_l^k(a)} f_l(z) \ dz,
\end{align*}
and the result follows by construction, and the continuity of $\theta'$:
\begin{equation}
    \displaystyle\sum_{j\in\Lambda} \int_0^{D^j} f^j(z) \ dz =
\sum_{i\in\lambda}\int_0^{D_i} f_i(z) \ dz.
\end{equation}

For completeness, in the case where the ISP $\kappa$ 
does not adhere to the market dynamics, so $p^\kappa > p^j +
\epsilon, \ \forall \ j \in\mcI$, then we may absorb the overage (difference) as part of the
bid fee.

(ADD TIME? INDUCTION GOES HERE? DID NOT SHOW!)

(OWN
WORDS) Since the sellers are driven by the buyers' demands, and the buyers are
competing in multiple local auctions hosted by the sellers, the two games are
inter-dependent, and may be played on the same or on a different scale in
valuation, time (AND....). 


PSP relies on the \emph{relevation prinicple}; the
PSP mechanism is able to demonstrate equlibrium by showing that PSP is
incentive-compatible. (MORE?)
Arrow's paradox is an impossibility theorem stating that when voters have three
or more distinct alternatives (options), no ranked voting electoral system can
convert the ranked preferences of individuals into a community-wide (complete
and transitive) ranking while also meeting a specified set of criteria:
unrestricted domain, non-dictatorship, Pareto efficiency and independence of
irrelevant alternatives.

Thus, (WHAT? FINISH, OWN WORDS)
The designer of a mechanism generally hopes either to design a mechanism
y() that "implements" a social choice function to find the
mechanism y() that maximizes some value criterion (e.g. profit)
Independence of irrelevant alternatives (IIA)
The IIA condition has three purposes (or effects)

Normative
Irrelevant alternatives should not matter.
Practical
Use of minimal information.
Strategic
Providing the right incentives for the truthful revelation of individual
preferences. 

\subsection{PSP Formulation}

We intend to show that our auction
is rational and achieves the desired VCG properties, as does the original
formulation. Using \cite{zheng} as a basis for our model, and \cite{lazar} as
realistic, theoretic, and notational templates, we define optimal strategies for
CMHK users, and demonstrate that the development of a set PSP auction mechanisms
in a data exchange setting is able achieve a network equilibrium for cellular data. 


% MECHANISM
\subsubsection{Data Auction Mechanism}\label{datamechanism}
We now proceed to formally define the PSP auction, which determines the actions 
buyers and sellers in the CMHK market, and which we will denote the \emph{data}
PSP rules. The rules presented here incorporate of the opt-out function with the
mechanism as in \cite{lazar}, which we note greatly simplifies our
analysis. 
The market price function (MPF) for a buyer in the CMHK market
can be described as follows:
% NEW MARKET PRICE
\begin{align}\label{dataprice}
\begin{split}
    &\bar{P}_i(z, s_{-i}) =\displaystyle\sum_{j\in\mcI}P_i^j(z_i^j,
s_{-i}^j) \circ e_i^j \\
    &= \sum_{j\in\mcI}\bigg(\inf\bigg\lbrace y\ge 0 : 
    {D_i^j}(y,s_{-i}^j) \ge e_i^j(z) \bigg\rbrace \bigg),\\
\end{split}
\end{align}
and is interpreted as the aggragate of minimum prices that buyer $i$ bids in
order to obtain
data amount $z$ given opponent profile $s_{-i}$. We note that
the total minimum price for the buyer must be an aggragation of the
\emph{individual} prices of the buyers as it is possible that the reserve prices
of the individual sellers may vary.\\
\textbf{Remark:} We further note that except at points of discontinuity, from
Lemma \ref{uservaluation} we have that $P_i^j(z) = f_i(z)$. \\

%To simplify the notation, we define $z_i^j = d^j / \vs_i^j$ opt-out
%buyer $i$'s bid quantity. 
The maximum available quantity of data in auction
$j$ at unit price $y$ given $s_{-i}^j$ is: 
% NEW ALLOCATION RULE
\begin{align}
\begin{split}\label{datacomposed}
    D_i^j(y,s_{-i}^j) = \bigg\lbrack D^j - \sum_{p_k^j> y} d_k^j\bigg\rbrack^+.
\end{split}
\end{align}
% DATA ALLOCATION RULE
The resulting data allocation rule is a function of the local market
interactions between buyers and sellers over all local auctions, as is composed with $i$'s opt-out value, so that for each $i \in \mcI$, the
allocation from auction $j$ is,
% and so for profile $s_i$, for any $i \in \mcI$,
\begin{align}\label{dataallocation}
\begin{split}
    \bar{a}_i^j(s) &= a_i^j(s) \circ e \\
    &= \min\bigg\lbrace e_i^j(a), \\
    &\frac{d_i^j}{\sum_{p_k^j= p_i^j}d_k^j} e_i \big(
D_i^j(p_i^j,s_{-i}^j)\big)\bigg\rbrace,
\end{split}
\end{align}
noting that for the full allocation from all auctions we may simply aggregate
over the seller pool.
Finally we must have that the cost to the buyer adheres to the second price
rule for each local auction, with total cost to buyer $i$,
% DATA COST
\begin{align}\label{datacost}
\begin{split}
    \bar{c}_i(s) &= \displaystyle\sum_{j\in\mcI} 
p^j \bigg(\bar{a}_i^j(0; s_{-i}^j)
    -\bar{a}_i^j(s_i^j;s_{-i}^j)\bigg).
\end{split}
\end{align}

\subsubsection{Mechanism Realization}\label{realization}

Consider a user seeking to prevent
data overage by purchasing enough data from a subset of other network users.
This user $i$ can be modeled as a opt-out buyer where, as in \cite{semret},
We intend to show that this network setting results in a shared network optima (a
global optimum). The formulation is inspired to the thinnest allocation route for
bandwidth given in \cite{lazar}. We note that if a single seller $j$ can
satisfy $i$'s demand, then
(\ref{buyerutility}) reduces to the original form, defined in
\cite{semret} as ``a simple buyer at a single resource element".

The sellers' auction will function as follows: at each bid iteration all buyers
submit bids, and the winning bid is the buyer $i$ that has the highest price
$p_i^j$. The seller allocates
data to this winner, at which point all other buyers are able to bid again, and
the winner leaves the auction (with the exception where multiple bidders bid
the same price, where (\ref{dataallocation}) determines they will not fully
satisfy their demand, and so we will assume they remain in the auction). The auction progresses as such until all the
sellers' data has been allocated. We design an algorithm based on the sellers'
fractional allocation strategy.

(NOTE - FIX TO UPDATED NOTATION!)
% SELLER ALGORITHM
\begin{algorithm}[H]
\caption{(Seller fractional allocation)}
\begin{algorithmic}[1]
\State $p^{j(0)} \gets \epsilon$
\State $s^{j(0)} \gets (p^j, D^j)$
\While{$D^j > 0$}
\State $\mcI^{j(t+1)} = \mcI^{j(t)}\setminus \lbrace i \in \mcI^{j(t)}: d_i^j >
D^{j(t)}\rbrace$
\State $ \bar{i} \gets \displaystyle\argmax_{I^j}\sum_{i\in I^j} p_i^j$ 
\State $D^{j(t+1)} \gets D^{j(t)} - e_{\bar{i}}^{j(t)}(a)$
%\State $p^j \gets \theta_{i^*}'(d_{i^*}^j)\circ e_i$
\State $p^j \gets p_{i^*}^j+\epsilon$ and $d^j \gets D^{j(t+1)}$
\State $s^{j(t+1)} \gets (d^j, p^j)$
\If{$\ \exists \ i : s_i^{j(t+1)} \ne s_i^{j(t)}$}
\State $D^{j(t+1)} = D^{j(t)}$
\State $t \gets t+1$
\State Go to 4.
\Else
\State $\bar{i} \gets e_{\bar{i}}^j(a)$
%\State $\beta^{j(t+1)} \gets \bigg\lbrace i\in\mcI^j: 
%        d_i \le \bar{b}^j \bigg\rbrace$
\State $t \gets t+1$
\State Go to 4.
\EndIf
\EndWhile
\end{algorithmic}
\end{algorithm}
We assume that each time that $s^j$ is updated it is shared with all
participating buyers. At this point buyers have the opportunity to bid again,
where a buyer that does not bid again is assumed to hold the same bid, since a
buyer dropping out of the auction will set their bid to $s_i^j=(0,0)$. As we will show in our analysis, the buyers are bidding truthfully; the
algorithm makes use of the fact that the sellers' valuation is determined by
the buyers' market and upholds the PSP mechanism. (CHECK) (ALSO $j$ NEEDS TO
UPDATE FOR NEW BUYERS, $j$'S CONTROL)

(BUYER ALGORITHM? WHY NOT..., CLEANER)

% VCG ANALYSIS
\section{PSP Analysis}\label{analysis}
\subsection{Equilibrium}

Consider an opt-out buyer $i\in\mcI$. A PSP auction
allows for a buyer to react to opponents bids, and so its incentive is based on
the opponent profile.

Due to (\ref{buyerutility}), $i$ only has an incentive to change its bid
quantity if it increases its opt-out value $e_i$, and therefore its utility. 
We will show that $i$ can coordinate its
bids over $\mcI_i$ so that the opt-out value $e_i$ is the same for each
$j \in\mcI_i$, and therefore, without loss of utility, $i$ may choose a seller pool 
using a ``consistent" strategy, where for any $j\in \mcI_i$, $d_i^j = d_i^k, \
\forall \ k \in \mcI_i$, and still have feasible best replies. 
Our result shows that a buyer may select $\mcI_i$ in order to maximize its
utility while maintaining a coordinated bid strategy. 
It is intuitive that, if $j^*
< I$, a buyer may increase the size of $\mcI_i$, thereby lowering its bid
quantity while obtaining the same (potential) allocation $a_i$. 
(OWN WORDS!)
One important question to ask is why a bidder should bid with identical unit
prices on (j) all auctions and not reduce the unit price to a level where he still wins the
amount q i . The reason for this can be found in the pricing rule of the PSP auction. 
% BUYER COORDINATION
{
\lemma{(Opt-out buyer coordination)}\label{coordinationlemma} 
Let $i\in\mcI$ be a opt-out buyer and fix all sellers' profiles $s^j$.
For any profile $S_i = (D_i, P_i)$, let $a_i \equiv \sum_j a_i^j(s)$ be the resulting data
allocation. For any fixed $S_{-i}$, a better reply for $i$ in any auction is $x_i =
(z_i,y_i)$, where $\forall \ j \in \mcI_i$,
\begin{align*}
    z_i^j &= e_i^{j^*}(a), \\
    y_i^j &= \theta_i'(z_i^j).
\end{align*}
Furthermore,
\begin{equation}\label{allocationcoordination}
    a_i^j(z_i,y_i) = z_i^{j},
\end{equation}
and
\begin{equation}\label{costcoordination}
    c_i^j(z_i,y_i) = y_i^{j},
\end{equation}
where $i$'s strategy is as in Proposition \ref{buyerstrategy}.
}\\
\textbf{Proof:}
As $s_{-i}$ is fixed, we omit it, in addition, we will use $u\equiv u_i \equiv u_i(s_i) \equiv
u_i(s_i;s_{-i})$. In full notation, we intend to show
$$
    u_i((d_i,p_i);s) \le u_i((z_i,y_i);s_{-i}).
$$
If there exists a seller who can fully satisfy $i$'s demand,
then $\vert\mcI_i\vert = 1$, and the case is trivial as no
coordination is necessary for a single bid. (SPECIAL CASE OF MONOPOLY? THINK!)\\
Otherwise, buyer $i$'s demand can only be satisfied by purchasing data from
multiple sellers.
We will show that $i$ may increase $\vert\mcI_i\vert$, and so decreasing
$d_i^j, \ \forall \ j\in\mcI_i$, without decreasing $u_i$.
Buyer $i$ maintains ordered set $\ell_i$ where the sellers with the
largest bid quantities are considered first; the index of seller $j^*$ defines
a minimal subset $\mcI_i$, satisfying (\ref{buyercoordinate}). By construction, 
$d_i^{j^*}$ is the minimum quantity offered by any $j\in \mcI_i$,
so $d_i^{j^*} \le d_i^j, \ \forall \ j \in \mcI_i$; $\mcI_i$ also defines the
maximum quantity bid of any $k \ni \mcI_i$.
Thus by (\ref{buyercoordinate}) and (\ref{opt-minallocation}), $\forall \ j\in \mcI_i$,
$k\ni\mcI_i$,
$$
    e_i^k(a) \le z_i^j = e_i^{j^*}(a) \le e_i^{j}(a),
$$
and so, 
\begin{equation}\label{minimaleq}
    e_i^{j^*}(a)  \le \bigg\lbrack D^{j} - \sum_{k\in \mcI^j : p_k^{j}> y_{i}^{j}} d_k^{j}\bigg\rbrack^+,
\end{equation}
The buyer valuation function (\ref{buyervaluation}), guarantees
that $\forall \ j\in\mcI_i$, $y_i^j \ge p_{i^*}^j$, where $p_{i^*}^j$ is the reserve price of seller $j$, defined in Proposision
\ref{sellerstrategy}, and is by definition the minimum price for a buyer bid to
be accepted. 
As $D_i$ is non-decreasing, $\forall \ j\in \mcI_i$,
$k\ni\mcI_i$,
$$
    D_i^j(y_i^j) \ge D_i^j(p_i^{j^*})\ge D_i^j(p_i^{k}).
$$
Furthermore, suppose there exists buyer $k\in \mcI^j$, such that
$e_k^{j^*}(a) \ge e_i^{j^*}(a)$ and so $d^j - d_k^j < z_i^{j}$, resulting in a
partial allocation. Bid $s_k \in S_i$, and so is considered in buyer $i$'s strategy. 
As buyer $i$ is allowed to choose subset $\mcI_i$, and $\mcI_i$ is a minimal
set, (\ref{buyercoordinate}) states that $n$ is such that $e_i^{j*}(a)
\ge e_k^{j^*}(a)$ for any $k$, therefore such a buyer $k$ cannot exist.
\iffalse
We have, $\forall \ j\in \mcI_i$, $k\ni\mcI_i$,
$$
    {\theta_i}'(e_i^{k}(a)) \ge {\theta_i}'(e_i^{j^*}(a)) \ge y_i^j.
$$
Now, suppose that $p_k^j = p_i^j$, however $d_k^j > d_i^j$...
\fi
Thus (\ref{minimaleq}) holds and so, by (\ref{dataallocation}),
\begin{align*}
     a_i^j(z_i,p_i) &=\min_{i\in\mcI^j}\bigg(z_i^j, \bigg\lbrack D^{j} - \sum_{p_k^{j}> y_i^{j}}
d_k^{j}\bigg\rbrack^+\bigg) \\
    &= z_i^{j}= e_i^{j^*}(a)
\end{align*}
where the last equality is by definition, and so (\ref{allocationcoordination}) is proven.
Now, since a buyer is only charged with the cost of excluding other players from the market, the
unit price does not influence the final charges. This unit price reflects the
valuation of the total resources gained from the multi-auction market, and so a buyer uses this price on all
auctions.
We have, $\forall \ j\  \in \mcI_i, \ \forall \ k \ni \ \mcI_i$,
$$
    y_i^j \ge p_i^j \ge p_{i^*}^j\ge p_i^k,
$$
and we observe that from (\ref{datacomposed}), $\bar{D}_i^j(y, s_{-i}) =
0 \ \forall \ y < p_{i^*}^j$, and so $y=0 \le \epsilon \Rightarrow e_i^j(a) = 0$,
and so clearly $z_i^k = 0, \ \forall \ k \ni \mcI_i$, and therefore,
\begin{align*}
    \displaystyle\sum_{j\in\mcI_i} c_i^j(z_i,y_i) =\sum_{j\in\mcI_i}
c_i^j(z_i,p_i),
\end{align*}
thus (\ref{costcoordination}) simply shows that changing the price $p^j_i$ to $y^j_i$ does not exclude any
additional buyers, as the bid $p^j_i$ was already above the reserve price of any
seller $j \in \mcI_i$.
We proceed to demonstrate that $x_i$ does not result in a loss of utility for
buyer $i$; we will show that
$$
    u_i \le u_i(z_i,y_i).
$$
From (\ref{allocationcoordination}), we have $a_i^{j}(z_i,y_i) = z_i^{j} = e_i^j(a(z_i,y_i))$, 
and so,
$$
    \theta_i\circ e_i^j(a(z_i,y_i)) = \theta_i\circ e_i^j(a),
$$ 
which holds $\forall \ j\in\mcI_i$.
Therefore, by the definition of utility (\ref{buyerutility}),
and the buyers' valuation (\ref{buyervaluation}), 
\begin{align*}
    &\theta_i\circ e_i(a(z_i,y_i)) - \theta_i(a)\circ e_i(a) \\
    &= u_i(z_i,y_i) - u_i =  \displaystyle\sum_{j\in\mcI_i} c_i^j -c_i^{j}(z_i,y_i)\\
    &= \sum_{j\in\mcI_i}\int_{a_i^j(z_i,p_i)}^{a_i^j} f_i(d_i^j - z) \ dz.
\end{align*}
Then, as $a_i(z_i,p_i) \le z_i^j \le a_i^j $, and noting that
$\theta_i\ge 0\Rightarrow f_i\ge 0$, we have $u_i(z_i,y_i) - u_i \ge 0$, $\forall \ j\in\mcI_i$.
%1. buyers have same d but diff p
%2. " same p but diff d i.e. d1 < d2
Finally, as we do
not increase the aggragate demand of the buyer, $\sum_{j\in\mcI_i} c_i^j(s) \le 
\sum_{j\in\mcI_i} b_i^j$, and so $x_i$ is feasible.

In effect, we are using the buyer demand
to partition the auction space based on their type (EXPLAIN). \\

\subsubsection{Incentive Compatibility}

We proceed to claim that the optimality of truth-telling holds in our
formulation, where the market functions as a hybrid of \cite{semret} and
\cite{zheng}. The opt-out buyers' market is comprised of the minimal subset of
sellers with the largest amounts of available data, described in the buyer strategy as $\mcI_i$.
To achieve incentive compatibility, we find that the opt-out buyer must choose this subset so that
its overall marginal value is greater than its market price.
The buyers' market price is calculated as the maximum of the reserve prices
of the sellers in the opt-out buyers' pool.
the market prices at the %different auctions, weighted by the data provisioning vector values.
The actual bids are
obtained from the opt-out buyers' strategy. The quantity to bid is given
by the auction mechanism, i.e. (\ref{dataprice}) and (\ref{datacomposed}), as
the maximim possible quantity of data that a buyer $i$ can bid over its seller
pool while maintaining its aggragate marginal valuation greater than the aggragate of
minimum prices maintained by the sellers in $i$'s pool.
As with a single resource, \cite{semret} and
\cite{lazar}, we show that truth-telling is optimal for the buyer, i.e. in each auction, the buyer sets
the bid price to the marginal value.

Seller $j$'s reserve price is determined by a
buyer $i \ni \mcI^j$, and therefore, even if this price is zero,
then $p^j = \epsilon \ge 0$.

We argue that if truthfulness holds \emph{locally} for both buyers and sellers, i.e. $p_i ={\theta_i}' \
\forall \ j \in \mcI_i$ and $p^j = {\theta^j}' \ \forall \ i \in\mcI^j$, then
there exists a local market
equilibrium (NOTE: NOT GLOBAL! YET). We have the following Proposition. For
completeness, we use the full notation. (BAD SENTENCE)

{
\proposition{(Incentive compatibility in local auctions)}
For any seller $j$, let time $t \in \tau$ be fixed and for any buyer $i\in
\mcI^j$, let $s_{-i}$ also be fixed. )VALIDATE: FOR ALL j) Define,
\begin{align}
\begin{split}\label{eta}
    \eta_i &= \sup\bigg\lbrace x\ge 0 : 
 {\theta_i}'(x) > \bar{P}_i^j(x)\bigg\rbrace, 
\end{split}\\
\begin{split}\label{chi}
    \chi_i &= \sup\bigg\lbrace x\ge 0: 
\displaystyle\int_0^x 
    \bar{P}_i(x) \ dx \le \sum_{j\in\mcI_i}b_i^j \bigg\rbrace,
\end{split}
\end{align}
$z = \min(\eta_i, \chi_i - \epsilon / \theta_i'(0))^+$, and for each $j \in
\mcI_i$, 
$$
    v_i^j = e_i^{j^*}(z) 
$$
and 
$$
    w_i^j = \theta_i'(z).% \circ e = \theta_i'(v_i^j).
$$
Then a (coordinated) $\epsilon$-best reply for the opt-out buyer is $t_i =
(v_i,w_i)$, i.e., $\forall \ s_i, u_i(t_i;s_{-i}) + \epsilon \ge u_i(s_i;
s_{-i})$.
%and fix $j$'s reserve price $p^j$ as is defined by (\ref{newprice}). 
With reserve prices $p^j >0$, there exists a ``truthful" local game embeddeded
in each local auction, and thus an equilibrium point for the local auction. 
}\\
\textbf{Proof:}
For the buyer, we show that $t_i$ is an $\epsilon$-best reply. That is,
$$
    u_i(t_i;s_{-i}) + \epsilon \ge u_i(s_i;s_{-i}).
$$
Let $z = \eta_i^j$. We have that $i\in\mcI^j$, 
and (\ref{buyerinversedemand}) defines $\theta_i'(z)$ as being
max of the reserve prices $p_i^j,\ \forall \ j\in\mcI_i$, therefore
(\ref{eta}) is such that,
$$
    \theta_i'(z) > \bar{P}_i^j(z),
$$ 
which implies, as (MORE) $\theta_i'$ is non-increasing and $P_i^j \ge 0$,
we have $\forall \ j \in \mcI_i$, 
\begin{align*}
    w_i^j &> P_i^j(v_i^j) \\
    \Rightarrow v_i^j &\le D_i^j(w_i^j) = D^j - \rho^j(w_i^j).
\end{align*}
And so, by (\ref{dataallocation}),
\begin{align*}
    a_i^j(t_i) &= v_i^j \\
    \Rightarrow \displaystyle\sum_{j\in\mcI_i} a_i^j(t_i) &= z.
\end{align*}
Therefore,
\begin{align*}
    \displaystyle\sum_{j\in\mcI_i}&\int_0^{v_i^j} P_i^j(x) \ dx =  \int_0^{z}
    \bar{P}_i^j(x) \ dx \\
    &= \sum_{j\in\mcI_i}\int_0^{e_i^j(z)} P_i^j(x) \ dx.
\end{align*}
Suppose $\exists \ s_i = (d_i, p_i)$ such that $u_i^j(s_i;s_{-i}) > u_i^j(t_i;
s_{-i}) + \epsilon$. The buyer coordinated strategy, from Propositions
\ref{coordinationlemma} and
\ref{buyerstrategy}, gives $s_{i^*} = (e_i\circ a_i(s), \ \theta_i'(z)) =
(z_i, c_i)$, where
for each $j\in \mcI$, $a_i^j(s_{i^*}; s_{-i}) = z_i^j$,
then clearly $u_i(s_{i*}, s_{-i}) \ge u_i(s_i, s_{-i}) \Rightarrow u_i(t_i;s_{-i}) -
u_i(s_i;s_{-i}) > \epsilon$. Denoting $z_i^j$ (fixed) as $\zeta$, 
$$
    \int_z^{\zeta} {\theta_i}'(x) \ dx- \int_z^{\zeta} \bar{P}_i(x) \ dx > \epsilon.
$$
For concave valuation functions, the first-order derivative of $\theta$ at point
$0$ gives the maximum slope of the valuation function, and so the factor $\epsilon
/ \theta'(0)$ guarantees that new bids will differ by at least
$\epsilon$, and as such, buyer $i$ will remain in
any local auction with reserve price determined by (\ref{???}). We therefore
verify that,
$$
    \displaystyle\int_{z}^{z +\epsilon / \theta_i'(0)} \theta_i'(x) \
dx \le \epsilon,
$$
and as $P_i^j \ge 0$, we have that, from the construction of $\zeta$,
$$
    \displaystyle\int_{z+\epsilon / \theta_i'(0)}^\zeta \theta_i'(x) \ dx -
\int_{z+\epsilon / \theta_i'(0)}^\zeta \bar{P}_i(x) \ dx > 0.
$$
If $\zeta > z + \epsilon / \theta_i'(0)$, then for some $\delta >0$,
$\theta_i(z+\epsilon / \theta_i'(0)+\delta) > P_i^j(z+\epsilon /
\theta_i'(0)+\delta)$, contradicting (\ref{eta}).
Now, if $\zeta \le z$, then $\theta_i'(z+\epsilon / \theta_i'(0)) < P_i^j(z+\epsilon /
\theta_i'(0))$, also a contradiction of (\ref{eta}), and so buyer $s_i$ cannot
exist.

We consider the other term in the minimization; let $z=\chi_i$. We have that
For any coordinated bid $s_i$ such that $u_i(z_i, c_i) > u_i(t_i)+
\epsilon$, then $\zeta > z
\Rightarrow c_i(s_{i}) > b_i$, and so is infeasible. 
Finally, by Lemma \ref{userunion}, for a single buyer-seller interaction, we
have that $f_i = f^j \Rightarrow \theta_i \circ e_i^j = \theta^j \circ e_i^j$.
Therefore $\theta_i' = {\theta^j}'$. We have by Proposision
\ref{sellerstrategy} and (\ref{???}eqn 30), that $\theta^j = \max_{i\in\mcI^j}
\theta_i$, and so for any $i\in\mcI^j, \theta^j(z) \ge \theta_i(z)$, and so $j$
cannot set a higher reserve price, and also cannot sell more data than the buyers'
bids, so we have that $j$'s bid is both truthful and optimal.
\\----------------------REF-------------------------\\
% NEW MARKET PRICE
\begin{align}
\begin{split}
    &\bar{P}_i(z, s_{-i}) =\displaystyle\sum_{j\in\mcI}P_i^j(z_i^j,
s_{-i}^j) \\
    &= \sum_{j\in\mcI}\bigg(\inf\bigg\lbrace y\ge 0 : 
    {D_i^j}(y,s_{-i}^j) \ge e_i^j(z) \bigg\rbrace \bigg),\\
\end{split}
\end{align}
% NEW ALLOCATION RULE
\begin{align}
\begin{split}
    D_i^j(y,s_{-i}^j) = \bigg\lbrack D^j - \sum_{p_k^j> y} d_k^j\bigg\rbrack^+,
\end{split}
\end{align}
% NEW INVERSE DEMAND
\begin{align}\label{datapriceinverse}
\begin{split}
    \bar{D}_i(y, s_{-i}) &= \displaystyle\sum_{j\in\mcI}\bigg(\sup\bigg\lbrace z\in \big[ 0,
    D^j \big] : \\
    &\bar{P_i}(z,s_{-i}^j) < y\bigg\rbrace\bigg).
\end{split}
\end{align}
% DATA ALLOCATION RULE
\begin{align}
    a_i^j(s) \\
    &= \min\bigg\lbrace e_i^j(D_i),
    \frac{d_i^j}{\sum_{p_k^j= p_i^j}d_k^j} D_i^j(p_i^j,s_{-i}^j)\bigg\rbrace.
\end{align}
% DATA COST
\begin{align}
\begin{split}
    \bar{c}_i(s) &= \displaystyle\sum_{j\in\mcI} 
p^j \bigg(ai^j(0; s_{-i}^j)
    -a_i^j(s_i^j;s_{-i}^j)\bigg).
\end{split}
\end{align}
% BUYER DEMAND 
\begin{equation}
    \rho^j(y) = \sum_{i\in\mcI : p_i^j\ge y} d_i^j, 
\end{equation}
% BUYER REVENUE 
\begin{equation}
    f_i(z) \triangleq \inf\big\lbrace y\ge 0:
        \rho_i^j(y) \ge z, \ \forall \ j \in \mcI\big\rbrace.
\end{equation}
% SELLER REVENUE 
\begin{equation}
    f^j(z) \triangleq \sup\big\lbrace y\ge 0:
        \rho_i^j(y) \ge z, \ \forall \ i \in \mcI\big\rbrace,
\end{equation}
\begin{equation}
    \theta_i \circ e_i^j = \int_0^{e_i^j(a)} f_i(z) \ dz,
\end{equation}
\begin{equation}
    \theta_i \circ e = \displaystyle\sum_{j\in\mcI}
 \int_0^{e_i^j(a)} f_i(z) \ dz.
\end{equation}
\begin{equation}
    \theta^j \circ e = \displaystyle\sum_{i\in\mcI}
 \int_0^{e_i^j(a)} f^j(z) \ dz.
\end{equation}
\begin{equation}
    d_i^j \ge e_i^j(a)
\end{equation}
\begin{equation}
    \displaystyle\sum_{i\in\mcI} e_i^j(a) \le \sum_{i\in\mcI} d^j_i \le D^j,
\end{equation}
\begin{equation}
    e_i^j(a) \le D^j - \sum_{k\in\mcI, k\ne i} e_k^j(a).
\end{equation}
\begin{equation}
   p_i^j \ge \min_{i\in\mcI}\big(p_i^j).
\end{equation}
\\----------------------------------------------------\\
(SELLER FINISH)\\
This forms a ``truthful" local game embeddeded within $j$'s auction with strategy space
restricted to $\epsilon$-best replies from buyers $\in \mcI^j$. Therefore we have that a
fixed point in the ``truthful" local game is a fixed point for the auction. We
further argue that as the set $\mcI^j$ is
computed at each bid iteration, that our result holds for time $(t+1) \in \tau$.


{
\lemma{(Static Data Nash Equilibrium)} 
}

% DATA NASH EQ
{
\theorem{(Data Nash Equilibrium)}
Using the rules of the data auction mechanism, the CMHK
\cite{zheng} converges to a $\epsilon$-Nash equilibrium. In the network auction
game with the data-PSP rules applied independently by each user according to their respective strategies, the secondary market converges to an $\epsilon$-Nash
equilibrium. 
}\\
\textbf{Proof:}
2. using the min price of sellers in the auction i.e. ${\theta_i}'(d_{i^*}^j) =
p^j$ is OK, \\
3. that bids are still feasible AND optimal \\
4. the algorithm achieves global economic equilibrium)\\
\textbf{NEED TO COVER:}\\
1. Change in buyer valuation \\
2. New buyers\\
3. Not enough buyers \\
4. Not enough data\\
\textbf{TRY:}\\
Sellers only act when the resources obtained by the buyers influence their
respective reserve prices, which agrees with the seller stragety of attempting
to sell their data in the first iteration. Therefore we claim there exists a
market stability and therefore, the existence of a Nash equilibrium. As the
valuation of the sellers is derived by the demand of the buyers, who are
bidding equivalent bids over a minimum subset of buyers, we claim that the seller
strategy, along with the seller constraint (\ref{??}) results in a global
market equilibrium.
We have shown that the local
equlibirium created by $j$ is stable from time $t$ to $(t+1)$. 
Now, suppose that buyer $i^*$ computes its best response $s_i^j = (v_i^j, w_i^j)$
Finally, suppose that
a buyer $k$ enters the market such that for some buyer $l\in\mcI^j$,
$$
    \displaystyle\sum_{i\in\mcI^j} p_i^je_i^j(a) + p_k^je_k^j(a) \ge
\sum_{i\in\mcI^j} p_i^je_i^j(a) - p_l^je_l^j(a),
$$
that is,



NOTES: (today)\\
2. finish seller incentive compat\\
3. work on progression\\
4. check reserve price = monopoly price


\subsection{Efficiency}

Formally, the
mechanism is equilbriumcient if at equilibrium, the allocation maximizes
$\sum_i\theta_i(a_i)$.
(NEED OWN WORDS)
The objective in designing the auction is that, at equilbrium, resources al-
ways go to those who value them most. Indeed, the PSP mechanism does
have that property. This can be loosely argued as follows: for each player,
the marginal valuation is never greater than the bid price of any opponent
who is getting a non-zero allocation. Thus, whenever there is a player j
whose marginal valuation is less than player i 's and j is getting a non-zero
allocation, i can take some away from j , paying a price less than i 's marginal
valuation, i.e. increasing u i , but also increasing the total value, since i 's
marginal value is greater. Thus at equilibrium, i.e. when no one can unilat-
erally increase P their utility, the total value is maximized.

\subsection{Convergence}

\end{multicols}

\begin{thebibliography}{9}

\bibitem{zheng}
L. Zheng, C. Joe-Wong, C. W. Tan, S. Ha and M. Chiangs, 
\textit{Secondary markets for mobile data: Feasibility and benefits of traded
data plans}, 2015 IEEE
Conference on Computer Communications (INFOCOM), Kowloon, 2015, pp. 1580-1588.

\bibitem{lazar}
A. A. Lazar and N. Semret, 
\textit{“Design and Analysis of the Progressive Second Price Auction for Network
Bandwidth Sharing,”} Telecommunication Systems, Special Issue on Network Economics, 2000.

\bibitem{semret} 
N. Semret, 
\textit{“Market Mechanisms for Network Resource Sharing,”
Ph.D. thesis}. 
Columbia University, 1999.

\bibitem{tuffin}
Bruno Tuffin,
\textit{Revisited Progressive Second Price Auction for Charging
Telecommunication Networks}.
[Research Report] RR-4176, INRIA, 2001.

\bibitem{qpsp}
Clare W. Qu, Peng Jia, and Peter E. Caines,
\textit{Analysis of a Class of Decentralized Decision Processes: Quantized
Progressive Second Price Auctions},
46th IEEE Conference on Decision and Control, New Orleans, LA, 2007, pp.
779-784.

\bibitem{cmhk}
\textit{China Mobile Hong Kong Company Limited}.
\url{https://www.hk.chinamobile.com/en/corporate_information/Data_N_VAS/DataTopup/index.html}.
2018

\bibitem{iia}
Andreu Mas-Colell, Michael Dennis Whinston, and Jerry R. Green, 
\textit{Microeconomic Theory}. Oxford University Press. 1995. p. 794.

\bibitem{matt}
Matthias Roggendorf and Fernando Beltr{\'a}n,
\textit{Simulation Model for the Dynamic Allocation of Network Resources in a
Competitive Wireless Scenario}. Mobility Aware Technologies and Applications, Springer Berlin Heidelberg. 2005.
pp. 54 - 64.

\bibitem{diffserve}
N. Semret, R. R. F. Liao, A. T. Campbell and A. A. Lazar, 
\textit{Pricing, provisioning and peering: dynamic markets for differentiated Internet services and
implications for network interconnections}, in IEEE Journal on Selected Areas in
Communications, vol. 18, no. 12, pp. 2499-2513, Dec. 2000.

\end{thebibliography}


\end{document}

